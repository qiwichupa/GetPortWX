#!/usr/bin/env python3

from subprocess import Popen, PIPE
import sys
import os
import base64
import wx
from yaml_config import YamlConfig
import appdirs



class MainWindow(wx.Frame):

    def __init__(self, parent, title, configfile, appPath):
        self.configfile = configfile
        self.appPath = appPath
        self.init_settings()

        wx.Frame.__init__(self, parent, title=title, style=wx.DEFAULT_FRAME_STYLE | wx.RESIZE_BORDER)
        mainpanel = wx.Panel(self)

        self.trans_button = wx.Button(mainpanel, label='Ok')
        self.trans_button.Bind(wx.EVT_BUTTON, self.find_port)

        self.text_output = wx.TextCtrl(mainpanel, style=wx.TE_MULTILINE | wx.TE_READONLY | wx.HSCROLL)

        sizer = wx.GridBagSizer()
        sizer.Add(self.trans_button, pos=(0, 0), flag=wx.LEFT|wx.EXPAND)
        sizer.Add(self.text_output, pos=(0, 1), flag=wx.RIGHT|wx.EXPAND)
        sizer.AddGrowableCol(1)
        sizer.AddGrowableRow(0)
        mainpanel.SetSizer(sizer)
        sizer.Fit(self)
        self.Layout()
        self.SetMinSize((200, 200))
        self.SetSize((200, 200))
        self.Show(True)

    def close(self, event):
        pass

    def find_port(self, event):
        d = self.settings.value('gw')
        c = self.settings.value('community')
        m = self.settings.value('mac')
        #filebase64 = b'IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwojIGNyYXBweSBhZGFwdGVkIGZvciBweXRob24gMyAoc2Vh\ncmNoIGJ5IG1hYy1hZGRyZXNzIHdvcmtzIGFuZCBub3RoaW5nIG1vcmUuKQoKI0NvcHlyaWdodCAo\nQykgMjAwOSAgQWxsZW4gU2FuYWJyaWEKI1RoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOyB5\nb3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5IGl0IHVuZGVyCiN0aGUgdGVybXMg\nb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJl\nZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOwojZWl0aGVyIHZlcnNpb24gMiBvZiB0aGUgTGljZW5zZSwg\nb3IgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KI1RoaXMgcHJvZ3JhbSBpcyBk\naXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLCBidXQgV0lUSE9V\nVCBBTlkgV0FSUkFOVFk7CiN3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YgTUVS\nQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLgojU2VlIHRo\nZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLiBZb3Ugc2hvdWxk\nIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIGkKI3RoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5z\nZSBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbTsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0\nd2FyZSBGb3VuZGF0aW9uLCBJbmMuLAojNTEgRnJhbmtsaW4gU3RyZWV0LCBGaWZ0aCBGbG9vciwg\nQm9zdG9uLCBNQSAwMjExMC0xMzAxIFVTQS4KCgoiIiJSZXZpc2lvbiAxLjE0IDA3LzE3LzE1CiAg\nICogRml4ZWQgc29tZSBzcGVsbGluZy4gU3VjaCBhcyAncmV0cmVpdmVfY29tbXVuaXRpZXMiCiAg\nICogQWRkZWQgbW9yZSB2ZXJib3NlIHN0YXRlbWVudHMuCiAgICogQWRkZWQgc29tZSBjb21tZW50\ncyBieSB0aGUgZGljdGlvbmFyaWVzCiIiIgoKIiIiUmV2aXNpb24gMS4xMyAxMC8wMS8wOQogICAg\nKiBGaXhlZCBsaW5lIDM0OCBhcyBwZXIgY2hyaXN0aWFuaGEuIHJldHVybiBubWFjLmxvd2VyKCkK\nICAgICAgVGhpcyBmaXggd2lsbCBhbGxvdyB5b3UgdG8gcGFzcyBhIE1BQyBpbiBhbGwgdXBwZXJj\nYXNlIGFuZCBzdGlsbCBtYXRjaCB0aG91Z2ggdGhlIHN3aXRjaCBpcyByZXNwb25kaW5nIGluIGxv\nd2VyY2FzZS4KIiIiCiIiIlJldmlzaW9uIDEuMTIgMDkvMTgvMDkKICAgICogQWRkZWQgZm9sbG93\nIHN3aXRjaCBvcHRpb24uIE5vdyB3aGVuIHlvdSBydW4gdGhlIFBvcnQgUmVwb3J0IHdpdGggdGhl\nIC0tcmVwb3J0IG9wdGlvbiwgeW91IGFuIGFsc28KICAgICAgcGFzcyB0aGUgLS1mb2xsb3cgb3B0\naW9uLiBUaGlzIG9wdGlvbiB3aWxsIGZvbGxvdyBldmVyeSBkcCBuZWlnaGJvciBjb25uZWN0ZXRk\nIHRvIHRoZSBzd2l0Y2ggeW91IGFyZQogICAgICBzY2FuaW5nIGFzIHdlbGwgYXMgdGhlIHN3aXRj\naGVzIGl0IGlzIHNjYW5uaW5nLgoiIiIKIiIiUmV2aXNpb24gMS4xMSAwOS8xMy8wOQogICAgKiBN\nb3JlIGNvZGUgY2xlYW4gdXAgYW5kIGFub3RoZXIgaW5jcmVhc2UgaW4gc3BlZWQuCiAgICAqIEFs\nc28gcG9ydF9yZXBvcnQgY2FuIG5vdyBmb2xsb3cgRXRoZXJDaGFubmVsCiAgICAqIEZpeGVkIGlz\nc3VlLCB3aGVyZSB0aGUgbWF0Y2hpbmcgb2YgdGhlIGNkcCBuZWlnaGJvciB3YXMgbm90IG1hdGNo\naW5nIGNvcnJlY3RseQoiIiIKIiIiUmV2aXNpb24gMS4xMCAwOS8wOS8wOQpDb2RlIENsZWFuIHVw\nIGFuZCBhIHNsaWdodCBpbmNyZWFzZSBpbiBzcGVlZCAoIGJ5IGEgZmV3IHNlY29uZHMgKSBkdXJp\nbmcgdGhlIHNlYXJjaCBieSBtYWMgb3IgaXAKIiIiCgoiIiJSZXZpc2lvbiAxLjkgMDUvMDgvMjAw\nOQpDb2RlIGNoYW5nZXMgYW5kIEFkZGVkIENEUCBzdXBwb3J0Li4KICAgICogRGV0ZWN0IENEUCBO\nZWlnaGJvcnMgZHVyaW5nIHRoZSBzY2FuIGZvciBNQUMgQWRkcmVzc2VzIG9yIElQIEFkZHJlc3Nl\ncwoiIiIKCiIiIiBSZXZpc2lvbiAxLjcgMDQvMzAvMDkKVGhpcyBpcyBhIGJpZyB1cGRhdGUgZm9y\nIFBvcnQgUmVwb3J0Li4uLiBJbiB0aGlzIHJldmlzaW9uIHRoZSBmb2xsb3dpbmcgYnJhbmRzIGFu\nZCBkZXZpY2VzIGFyZSBzdXBwb3J0ZWQKICAgMS4gQ2lzY28KICAgICAgICAgICogQ2F0YWx5c3Qg\nNjUwOSB3LyBTdXBlcnZpc29yIDcyMCBydW5uaW5nIElPUwogICAgICAgICAgKiBDYXRhbHlzdCAz\nNTYwCiAgICAgICAgICAqIENhdGFseXN0IDM1NTAgKFNNSSkKICAgICAgICAgICogQ2lzY28gQ0lH\nRVNNIHNlcmllcyBDaGFzc2lzIEJsYWRlcwogICAgICAgICAgKiBDaXNjbyBDYXRhbHlzdCAyOTYw\nCiAgIDIuIEZvdW5kcnkKICAgICAgICAgICogRm91bmRyeSBTZXJ2ZXIgSXJvbgogICAzLiBOb3J0\nZWwKICAgICAgICAgICogTm9ydGVsIFBhc3Nwb3J0IDg2MDAKICAgICAgICAgICogTm9ydGVsIDU1\nMjAgRXRoZXJuZXQgUm91dGluZyBTd2l0Y2gKICAgNC4gSFAKICAgICAgICAgICogSFAgUHJvY3Vy\ndmUgNTQwNnhsCiIiIgojTm93IGF0IHRoZSA1dGggcmV2aXNpb24gMS41IDA0LzIxLzA5CiIiIlRo\naXMgaXMgYSBjb21wbGV0ZSByZXdyaXRlIG9mIHRoZSBnZXRfcG9ydC5weSBzY3JpcHQgMDQvMTIv\nMDkKVGhpcyBzY3JpcHQgbm93IGFjY3VyYXRlbHkgcmVwb3J0cyBhbGwgTUFDIEFkZHJlc3NlcyBv\nbiB0aGUgUG9ydCB0aGF0IHlvdSBzcGVjaWZpZWQKICAgKkFsc28gYmV0dGVyIGVycm9yIGNoZWNr\naW5nIGFkZGVkCiAgICpDbGVhbmVyIENvZGUKICAgKlJldXNhYmxlIEZ1bmN0aW9ucwpUaGlzIHNj\naXB0IGlzIGludGVuZGVkIGZvciBBZG1pbmlzdHJhdG9yL0VuZ2luZWVycyB3aG8gbmVlZCB0byBm\naW5kIHRoZSBwb3J0IG9uIGEgc3dpdGNoCnRoYXQgdGhleSBhcmUgcGx1Z2dlZCBpbnRvIHVzaW5n\nIGVpdGhlciB0aGUgTUFDIEFkZHJlc3Mgb3IgdGhlIElQIEFkZHJlc3MuClNvIGZhciB0aGlzIGhh\ncyBiZWVuIHRlc3RlZCBvbiBDaXNjbyBTd2l0Y2hlcywgdGhvdWdoIEkgYXNzdW1lIGl0IHdpbGwg\nd29yayBvbiBvdGhlciBvbmVzIGFzIHdlbGwiIiIKCmltcG9ydCBzeXMKaW1wb3J0IHJlCmltcG9y\ndCBzdHJpbmcKaW1wb3J0IGdldG9wdApmcm9tIHRpbWUgaW1wb3J0IGN0aW1lCmZyb20gc29ja2V0\nIGltcG9ydCBnZXRob3N0YnlhZGRyCgoKdHJ5OgogICAgZnJvbSBweXNubXAuZW50aXR5LnJmYzM0\nMTMub25lbGluZXIgaW1wb3J0IGNtZGdlbgpleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICBwcmlu\ndCgiWW91IG5lZWQgdG8gZG93bmxvYWQgcHlzbm1wIGFuZCBweWFzbjEiLCBlKQogICAgc3lzLmV4\naXQoMSkKCmRlZiB1c2FnZSgpOgogICAgcHJpbnQoIiIiCiAgICAtZCwgLS1kZXZpY2UgICAgICAg\nIFRoaXMgaXMgdGhlIGRldmljZSB5b3Ugd2FudCB0byBzY2FuCiAgICAtYywgLS1jb21tdW5pdHkg\nICAgIFRoaXMgaXMgdGhlIFNOTVAgY29tbXVuaXR5IHN0cmluZyB0byB1c2UKICAgIC1tLCAtLW1h\nYyAgICAgICAgICAgVGhpcyBpcyB0aGUgTUFDIEFkZHJlc3MgeW91IGFyZSB1c2luZyB0byBzZWFy\nY2ggZm9pciB3aGF0IHBvcnQgeW91ciBkZXZpY2UgaXMgcGx1Z2dlZCBpbnRvCiAgICAtaSwgLS1p\ncCAgICAgICAgICAgIFRoaXMgaXMgdGhlIElQIEFkZHJlc3MgeW91IGFyZSB1c2luZyB0byBmaW5k\nIHRoZSBNQUMgQWRkcmVzcyBvZiB0aGUgZGV2aWNlIGFuZCBUaGUgcG9ydCBpbiB0aGUgc3dpdGNo\nZWQgaXQgaXMgcGx1Z2dlZCBpbnRvCiAgICAtbiwgLS1wbmFtZSAgICAgICAgIFRoaXMgaXMgdGhl\nIFBvcnQgTmFtZSB5b3UgYXJlIHNlYXJjaGluZyBGb3IKICAgIC12LCAtLXZlcmJvc2UgICAgICAg\nVGhpcyB3aWxsIHByaW50IG91dCB0aGUgdGltZSBzdGFtcHMgb2YgdGhlIGZvciBsb29wcyBhbmQg\nb2YgdGhlIGZ1bmN0aW9ucwogICAgLXIsIC0tcmVwb3J0ICAgICAgICBUaGlzIHdpbGwgcHJpbnQg\nb3V0IGFsbCB0aGUgbWFjIGFkZHJlc3NlcyBvbiB0aGUgc3dpdGNoIHlvdSBhcmUgc2Nhbm5pbmcg\nYW5kIHdoYXQgcG9ydHMgdGhleSBhcmUgY29ubmVjdGVkIHRvLgogICAgLWYsIC0tZm9sbG93ICAg\nICAgICBUaGlzIHdpbGwgZm9sbG93IGFsbCB0aGUgY2RwIG5laWdoYm9ycyBmb3VuZCBwZXIgc3dp\ndGNoIHdoZW4gdXNpbmcgdGhlIC1yIG9yIC0tcmVwb3J0IG9wdGlvbi4KICAgIGV4YW1wbGUgYmVs\nb3cuLgogICAgcHl0aG9uIHBvcnRfcmVwb3J0LnB5IC1kIDE5Mi4xNjguMTAxLjEgLWMgcHVibGlj\nIC1pICIxOTIuMTY4LjEwMS4yMDEiCiAgICBUaGlzIElQQWRkcmVzcyBpcyBub3QgaW4gdGhlIEFS\nUCB0YWJsZQogICAgcHl0aG9uIHBvcnRfcmVwb3J0LnB5IC1kIDE5Mi4xNjguMTAxLjEgLWMgcHVi\nbGljIC1pICIxOTIuMTY4LjEwMS4yMDkiCiAgICBNQUMgID0gMDAgMTQgMzggN2YgNmUgMzgKICAg\nIFBvcnQgPSBHaWdhYml0RXRoZXJuZXQxLzE3CiAgICBWbGFuID0gMTc1CiAgICBJUEFkZHIgPSAx\nOTIuMTY4LjEwMS4yMDkKICAgIHB5dGhvbiBwb3J0X3JlcG9ydC5weSAtZCAxOTIuMTY4LjEwMS4x\nIC1jIHB1YmxpYyAtbSAiMDAgMTQgMzggNGYgNWUgMzkiCiAgICBNQUMgID0gMDAgMTQgMzggNGYg\nNWUgMzkKICAgIFBvcnQgPSBHaWdhYml0RXRoZXJuZXQxLzE3CiAgICBWbGFuID0gMTc1CiAgICBJ\nUEFkZHIgPSAxOTIuMTY4LjEwMS4yMDEKICAgIHB5dGhvbiBwb3J0X3JlcG9ydC5weSAtZCAxOTIu\nMTY4LjEwMS4xIC1jIHB1YmxpYyAtbiAiMS80MCIKICAgIFBvcnQgMS80MCBoYXMgdGhlIGJlbG93\nIE1BQyBBZGRyZXNzZXMgYXNzb2NpYXRlZCB3aXRoIGl0CiAgICBNQUMgID0gMDAgMWIgOTUgOTcg\nM2MgODEKICAgIFBvcnQgPSBHaWdhYml0RXRoZXJuZXQxLzQwCiAgICBWbGFuID0gMQogICAgSVBB\nZGRyID0gVGhlIElQIEFkZHJlc3MgZm9yIHRoaXMgTUFDIGlzIG5vdCBpbiB0aGUgQVJQIFRhYmxl\nCiAgICBNQUMgID0gMDAgMTUgZmEgYjQgMTAgMDYKICAgIFBvcnQgPSBHaWdhYml0RXRoZXJuZXQx\nLzQwCiAgICBWbGFuID0gMTc0CiAgICBJUEFkZHIgPSBUaGUgSVAgQWRkcmVzcyBmb3IgdGhpcyBN\nQUMgaXMgbm90IGluIHRoZSBBUlAgVGFibGUKICAgIFRvdGFsIE1BQyBBZGRyZXNzZXMgYXNzb2Np\nYXRlZCB3aXRoIHRoaXMgaW50ZXJmYWNlIDIKICAgIHB5dGhvbiBwb3J0X3JlcG9ydC5weSAtZCAx\nOTIuMTY4LjEwMS4xIC1jIHB1YmxpYyAtbiAiMS8yIgogICAgUG9ydCAxLzIgaGFzIHRoZSBiZWxv\ndyBNQUMgQWRkcmVzc2VzIGFzc29jaWF0ZWQgd2l0aCBpdAogICAgTUFDICA9IDA4IDAwIDBmIDIw\nIGIzIGFhCiAgICBQb3J0ID0gR2lnYWJpdEV0aGVybmV0MS8yCiAgICBWbGFuID0gMTc2CiAgICBJ\nUEFkZHIgPSAxOTIuMTY4LjEwMS4xMDQKICAgIHB5dGhvbiBwb3J0X3JlcG9ydC5weSAtZCAxOTIu\nMTY4LjEwMS4xIC1jIHB1YmxpYyAtciAtZgogICAgUnVubmluZyBTd2l0Y2ggUmVwb3J0IG9uIDE5\nMi4xNjguMTAxLjEKICAgIEdpZ2FiaXRFdGhlcm5ldDEvNDAsMDAgMWIgOTAgOTkgM2QgODMsTm9u\nZSxOb25lLHZsYW4xLHVwLHVwLHVua25vd24sMTAwMG1iLAogICAgR2lnYWJpdEV0aGVybmV0MTAv\nMTUsMDAgMjMgNWUgZWYgMzQgODEsMTkyLjE2OC4xMDEuMixQb2ludGVyIFJlY29yZCBOb3Qgc2V0\nIGZvciAxOTIuMTY4LjEwMS42Mix2bGFuMSx1cCx1cCxmdWxsRHVwbGV4LDEwMDBtYixHSUcgTGFz\nZXIgdG8gNzFGaWZ0aAogICAgR2lnYWJpdEV0aGVybmV0MS8zNCwwMCAwMSAwMiAwMyAwMyAwNSxO\nb25lLE5vbmUsdmxhbjE3NCx1cCx1cCx1bmtub3duLDEwMDBtYixDQ0FfQ0FTIFVudHJ1c3RlZCBJ\nbnRlcmZhY2UgSVAgMTY4LjMKICAgICIiIikKICAgIHN5cy5leGl0KDApCgpkZWYgdG9fc3RyICh2\nYWx1ZSk6CiAgICB2YWx1ZVN0ciA9ICcuJy5qb2luKFtzdHIoeCkgZm9yIHggaW4gdmFsdWUuYXNO\ndW1iZXJzKCldKQogICAgcmV0dXJuKHZhbHVlU3RyKQoKZGVmIG1haW4oKToKICAgIGlmIHZlcmJv\nc2U6IHByaW50KGN0aW1lKCksICIgTWFpbiBTdGFydGVkICIpCiAgICBpZiAoIGNvbW11bml0eSBh\nbmQgZGV2aWNlIGFuZCAoIG1hYyBvciBpcCBvciBwbmFtZSBvciByZXBvcnQgKSApOgogICAgICAg\nIHNubXBlcnJvciwgc3dpdGNodHlwZSA9IGdldCggZGV2aWNlLCBjb21tdW5pdHksIG9UYWJsZVsi\nc3lzRGVzY3IiXSwgMCApCiAgICAgICAgc3dpdGNodHlwZSA9IHN0cihzd2l0Y2h0eXBlKQogICAg\nICAgIGlmIHNubXBlcnJvcjoKICAgICAgICAgICAgcHJpbnQoc25tcGVycm9yLCAiRWl0aGVyIFdy\nb25nIENvbW11bml0eSBTdHJpbmcgb3IgRmlyZXdhbGwgb3IgU05NUCBOb3QgUnVubmluZyIpCiAg\nICAgICAgICAgIHN5cy5leGl0KDEpCiAgICAgICAgc2JyYW5kID0gTm9uZQogICAgICAgIHNjYW5u\nZWRfbmVpZ2hib3IgPSBGYWxzZQogICAgICAgIGRzd2l0Y2ggPSBkZXZpY2UKICAgICAgICBzd2l0\nY2ggPSBmb2xsb3dTd2l0Y2goIGRzd2l0Y2gsIGNvbW11bml0eSApCiAgICAgICAgZW50SXBMaXN0\nID0ge30KICAgICAgICBpcExpc3QgPSBbXQogICAgICAgIGVudGFkZHIgPSB3YWxrKCBkZXZpY2Us\nIGNvbW11bml0eSwgb1RhYmxlWyJpcEFkRW50QWRkciJdICkKICAgICAgICBmb3IgbGluZSBpbiBl\nbnRhZGRyOgogICAgICAgICAgICBpcExpc3QuYXBwZW5kKHN3aXRjaC5jb252ZXJ0T2N0ZWN0SXAo\nIHRvX3N0cihsaW5lWzBdWzFdKSApKQogICAgICAgIGVudElwTGlzdFtkZXZpY2VdID0gaXBMaXN0\nCiAgICAgICAgbmlwID0gIiIKICAgICAgICBubWFjID0gIiIKICAgICAgICBjb3VudCA9IDAKICAg\nICAgICBpZiBtYWMgb3IgaXA6CiAgICAgICAgICAgIHN3aXRjaC5zZXRfZHVwbGV4KCkKICAgICAg\nICAgICAgc3dpdGNoLnNldF9zcGVlZCgpCiAgICAgICAgICAgIHN3aXRjaC5zZXRfcG9ydF9uYW1l\nKCkKICAgICAgICAgICAgc3dpdGNoLnNldF9waHlzX2FkZHIoKQogICAgICAgICAgICBpZiB2ZXJi\nb3NlOiBwcmludCgiXG5Zb3Ugc2hvdWxkIGdldCB0aGUgc3dpdGNodHlwZSBhZnRlciB0aGlzOlxu\nIikKICAgICAgICAgICAgaWYgdmVyYm9zZTogcHJpbnQoc3dpdGNodHlwZSkKICAgICAgICAgICAg\nbVRhYmxlID0gIiIKICAgICAgICAgICAgaWYgbWFjOgogICAgICAgICAgICAgICAgbm1hYyA9IG1h\nYwogICAgICAgICAgICAgICAgbm1hYywgdmFsaWQgPSB2ZXJpZnlfbWFjKCBubWFjICkKICAgICAg\nICAgICAgICAgIGlmIG5vdCB2YWxpZDoKICAgICAgICAgICAgICAgICAgICBwcmludCgiWW91ciBt\nYWMgJXMgaXMgaW4gdGhlIHdyb25nIGZvcm1hdCIgJSAobWFjKSkKICAgICAgICAgICAgICAgICAg\nICBzeXMuZXhpdCgxKQogICAgICAgICAgICAgICAgbmlwID0gc3dpdGNoLmZpbmRJcEJ5TWFjKCBu\nbWFjICkKICAgICAgICAgICAgaWYgaXA6CiAgICAgICAgICAgICAgICBuaXAgPSBpcAogICAgICAg\nICAgICAgICAgbm1hYyA9IHN3aXRjaC5maW5kTWFjQnlJcCggbmlwICkKICAgICAgICAgICAgICAg\nIGlmIG5tYWMgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICBwcmludCgiVGhpcyBJUCBBZGRy\nZXNzLCAlcyAsIGlzIG5vdCBpbiB0aGUgQVJQIHRhYmxlIiAlIChpcCkpCiAgICAgICAgICAgICAg\nICAgICAgc3lzLmV4aXQoMSkKCiAgICAgICAgICAgIGlmICggcmUuc2VhcmNoKCJDaXNjb3xQUk9D\nVVJWRXxIUHxOb3J0ZWx8RVJTfEZvdW5kcnkiLCBzd2l0Y2h0eXBlLCByZS5JR05PUkVDQVNFICkg\nKToKICAgICAgICAgICAgICAgIG1UYWJsZSwgaWZJbmRleCA9IHN3aXRjaC5maW5kX21hYyggbm1h\nYywgbmlwICkKICAgICAgICAgICAgICAgIGNvdW50ID0gMAogICAgICAgICAgICAgICAgc3N3aXRj\naCA9IGRzd2l0Y2gKICAgICAgICAgICAgICAgIGlmIChtVGFibGUpOgogICAgICAgICAgICAgICAg\nICAgIGNvdW50ICs9IDEKICAgICAgICAgICAgICAgICAgICBmb3Iga2V5LCB2YWwgaW4gbGlzdCht\nVGFibGUuaXRlbXMoKSk6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCJTd2l0Y2ggQ29u\nbmVjdGVkIHRvICVzIiAlICggZHN3aXRjaCApKQogICAgICAgICAgICAgICAgICAgICAgICBwcmlu\ndCgiU3dpdGNoUG9ydCA9ICVzXG5Td2l0Y2hQb3J0U3BlZWQgPSAlc1xuU3dpdGNoUG9ydER1cGxl\neCA9ICVzXG5Td2l0Y2hWbGFuID0gJXMiICUgXAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAoIHZhbFsiaWZEZXNjciJdLCB2YWxbImlmU3BlZWQiXSwgdmFsWyJpZkR1cGxleCJdLCB2YWxb\nInZsYW4iXSApKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludCgiU25tcEhvc3ROYW1lID0g\nJXNcblNubXBIb3N0RGVzY3IgPSAlc1xuSG9zdE1BQyAgPSAlc1xuSG9zdElQID0gJXNcbkhvc3RO\nYW1lID0gJXNcbiIgJSBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICggdmFsWyJzeXNO\nYW1lIl0sIHZhbFsic3lzRGVzY3IiXSwgdmFsWyJubWFjIl0sIHZhbFsiaXBBZGRyIl0sIHZhbFsi\naG9zdE5hbWUiXSApKQogICAgICAgICAgICAgICAgICAgICAgICBpZiByZS5zZWFyY2goIlBvcnQt\nY2hhbm5lbCIsIHZhbFsiaWZEZXNjciJdKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIHZlcmJvc2U6IHByaW50KCJpZkluZGV4ICVkIGlzIGEgJXMgaW50ZXJmYWNlIiAlICggaWZJbmRl\neCwgdmFsWyJpZkRlc2NyIl0gKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmSW5kZXhf\ncGFncF9saXN0ID0gc3dpdGNoLmdldF9wYWdwX3BvcnRzKCBpZkluZGV4ICkKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIHZlcmJvc2U6IHByaW50KCJMaXN0IG9mIEludGVyZmFjZXMgaXMg\naW4gRXRoZXJDaGFubmVsOiAiLCBpZkluZGV4X3BhZ3BfbGlzdCkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGlmSW5kZXggPSBpZkluZGV4X3BhZ3BfbGlzdFswXQogICAgICAgICAgICAgICAg\nbmVpZ2hib3IgPSBmb2xsb3dTd2l0Y2goZHN3aXRjaCwgY29tbXVuaXR5KS5nZXRfY2RwX25laWdo\nYm9yX2lwKCBpZkluZGV4ICkKICAgICAgICAgICAgICAgIGlmIG5laWdoYm9yOgogICAgICAgICAg\nICAgICAgICAgIGlmIHZlcmJvc2U6IHByaW50KG5laWdoYm9yKQogICAgICAgICAgICAgICAgICAg\nIHNzd2l0Y2ggPSBkc3dpdGNoCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgbmVpZ2hib3I6CiAg\nICAgICAgICAgICAgICAgICAgICAgIG9sZF9uZWlnaGJvciA9IG5laWdoYm9yCiAgICAgICAgICAg\nICAgICAgICAgICAgIG5ld19uZWlnaGJvciA9IGZvbGxvd1N3aXRjaChzc3dpdGNoLCBjb21tdW5p\ndHkpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmSW5kZXgsIGNvdW50MSA9IG5ld19uZWlnaGJv\nci5nZXRfbWFjX2Zyb21fY2RwX25laWdoYm9yKCBuZWlnaGJvciwgbm1hYywgbmlwICkKICAgICAg\nICAgICAgICAgICAgICAgICAgY291bnQgKz0gY291bnQxCiAgICAgICAgICAgICAgICAgICAgICAg\nIHNzd2l0Y2ggPSBuZWlnaGJvcgogICAgICAgICAgICAgICAgICAgICAgICBuZWlnaGJvciA9IGZv\nbGxvd1N3aXRjaChzc3dpdGNoLCBjb21tdW5pdHkpLmdldF9jZHBfbmVpZ2hib3JfaXAoIGlmSW5k\nZXggKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBuZWlnaGJvcjoKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGVudGFkZHIgPSB3YWxrKCBzc3dpdGNoLCBjb21tdW5pdHksIG9UYWJsZVsi\naXBBZEVudEFkZHIiXSApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpcGxpc3QgPSBbXQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGxpbmUgaW4gZW50YWRkcjoKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBpcExpc3QuYXBwZW5kKG5ld19uZWlnaGJvci5jb252ZXJ0\nT2N0ZWN0SXAoIHRvX3N0cihsaW5lWzBdWzFdKSApKQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgZW50SXBMaXN0W25laWdoYm9yXSA9IGlwTGlzdAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgZm9yIGtleSwgdmFsdWUgaW4gbGlzdChlbnRJcExpc3QuaXRlbXMoKSk6CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgZm9yIGxpbmUgaW4gdmFsdWU6CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGlmIGxpbmUgPT0gbmVpZ2hib3I6CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBzY2FubmVkX25laWdoYm9yID0gVHJ1ZQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoInRoaXMgbmVpZ2hib3IgaGFzIGFs\ncmVhZHkgYmVlbiBzY2FubmVkIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHByaW50KGxpbmUsIG5laWdoYm9yKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgbmVpZ2hib3IgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgaWYgKCBjb3VudCA+\nPSAxICk6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCJUaGlzIE1BQyAlcyB3YXMgZmlu\nYWxseSB0cmFjZWQgdG8gdGhpcyBzd2l0Y2ggJXMiICUgKCBubWFjLCBzc3dpdGNoICkpCiAgICAg\nICAgICAgIGlmICggY291bnQgPT0gMCApOgogICAgICAgICAgICAgICAgcHJpbnQoIlRoZSBNYWMg\nQWRkcmVzcyAlcyBpcyBub3Qgb24gdGhpcyBzd2l0Y2ggJXMiICUgKCBubWFjLCBkc3dpdGNoICkp\nCgoKICAgICAgICBpZiBwbmFtZToKICAgICAgICAgICAgY291bnQgPSAwCiAgICAgICAgICAgIHN3\naXRjaC5zZXRfZHVwbGV4KCkKICAgICAgICAgICAgc3dpdGNoLnNldF9zcGVlZCgpCiAgICAgICAg\nICAgIHN3aXRjaC5zZXRfcG9ydF9uYW1lKCkKICAgICAgICAgICAgc3dpdGNoLnNldF9waHlzX2Fk\nZHIoKQogICAgICAgICAgICBzd2l0Y2guZmluZF9wb3J0X21hdGNoKCBwbmFtZSApCiAgICAgICAg\nICAgIGlmSW5kZXggPSBzd2l0Y2guZ2V0X2lmSW5kZXgoKQogICAgICAgICAgICBpZk5hbWUgPSBz\nd2l0Y2guZ2V0X2lmTmFtZSgpCiAgICAgICAgICAgIHNicmFuZCA9IHN3aXRjaC5nZXRfc2JyYW5k\nKCkKICAgICAgICAgICAgY29ubmVjdGVkX21hY3MgPSBbXQogICAgICAgICAgICBpZiAoIHJlLnNl\nYXJjaCgiQ2lzY298UFJPQ1VSVkV8SFAiLCBzd2l0Y2h0eXBlLCByZS5JR05PUkVDQVNFICkgKToK\nICAgICAgICAgICAgICAgIGxjb21tLCBsdmxhbiA9IHN3aXRjaC5yZXRyaWV2ZV9jb21tdW5pdGll\ncyggKQogICAgICAgICAgICAgICAgaWYgdmVyYm9zZTogIHByaW50KGN0aW1lKCksICJSZXRyaWV2\naW5nIENvbW11bml0eSBTdHJpbmdzICVzXG4iICUgKCBsY29tbSApKQogICAgICAgICAgICAgICAg\nZm9yIGkgaW4gcmFuZ2UobGVuKGxjb21tKSk6CiAgICAgICAgICAgICAgICAgICAgbWRpY3QgPSBz\nd2l0Y2gucmV0dXJuX21hY19ieV9pZkluZGV4KCBsY29tbVtpXSwgbHZsYW5baV0gKQogICAgICAg\nICAgICAgICAgICAgIGlmIG1kaWN0OgogICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0ZWRf\nbWFjcy5hcHBlbmQobWRpY3QpCiAgICAgICAgICAgIGVsaWYgKCByZS5zZWFyY2goIk5vcnRlbHxF\nUlN8Rm91bmRyeSIsIHN3aXRjaHR5cGUsIHJlLklHTk9SRUNBU0UgKSApOgogICAgICAgICAgICAg\nICAgY29tbSA9IGNvbW11bml0eQogICAgICAgICAgICAgICAgdmxhbiA9IE5vbmUKICAgICAgICAg\nICAgICAgIG1kaWN0ID0gc3dpdGNoLnJldHVybl9tYWNfYnlfaWZJbmRleCggY29tbSwgdmxhbiAp\nCiAgICAgICAgICAgICAgICBpZiBtZGljdDoKICAgICAgICAgICAgICAgICAgICBjb25uZWN0ZWRf\nbWFjcy5hcHBlbmQobWRpY3QpCiAgICAgICAgICAgIGlmIGxlbihjb25uZWN0ZWRfbWFjcykgPiAw\nOgogICAgICAgICAgICAgICAgZm9yIGhvc3QgaW4gY29ubmVjdGVkX21hY3M6CiAgICAgICAgICAg\nICAgICAgICAgZm9yIGtleSwgdmFsIGluIGxpc3QoaG9zdC5pdGVtcygpKToKICAgICAgICAgICAg\nICAgICAgICAgICAgY291bnQgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICBwcmludCgiU3dp\ndGNoUG9ydCA9ICVzXG5Td2l0Y2hQb3J0U3BlZWQgPSAlc1xuU3dpdGNoUG9ydER1cGxleCA9ICVz\nXG5Td2l0Y2hWbGFuID0gJXMiIFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUgKCB2\nYWxbImlmRGVzY3IiXSwgdmFsWyJpZlNwZWVkIl0sIHZhbFsiaWZEdXBsZXgiXSwgdmFsWyJ2bGFu\nIl0gKSkKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIlNubXBIb3N0TmFtZSA9ICVzXG5I\nb3N0RGVzY3IgPSAlc1xuSG9zdE1BQyAgPSAlc1xuSG9zdElQID0gJXNcbkhvc3ROYW1lID0gJXNc\nbiIgXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJSAoIHZhbFsic3lzTmFtZSJdLCB2\nYWxbInN5c0Rlc2NyIl0sIHZhbFsibm1hYyJdLCB2YWxbImlwQWRkciJdLCB2YWxbImhvc3ROYW1l\nIl0gKSkKICAgICAgICAgICAgICAgIHByaW50KCJUaGVyZSBhcmUgJWQgTUFDIEFkZHJlc3NlcyBj\nb25uZWN0ZWQgdG8gcG9ydCAlcyIgJSAoIGNvdW50LCBwbmFtZSApKQogICAgICAgICAgICBlbHNl\nOgogICAgICAgICAgICAgICAgcHJpbnQoIlRoZXJlIGFyZSBub3QgYW55IE1BQyBBZGRyZXNzZXMg\nY29ubmVjdGVkIHRvIHRoaXMgJXMgcG9ydCIgJSAoIHBuYW1lICkpCgogICAgICAgIGlmIHJlcG9y\ndDoKICAgICAgICAgICAgZHN3aXRjaCA9IGRldmljZQogICAgICAgICAgICBjb3VudCA9IHdyaXRl\nX3JlcG9ydChkc3dpdGNoLCBlbnRJcExpc3QpCiAgICAgICAgICAgIHRjb3VudCA9IDAKICAgICAg\nICAgICAgaWYgZm9sbG93OgogICAgICAgICAgICAgICAgZm9yIGl0ZW0gaW4gY291bnQ6CiAgICAg\nICAgICAgICAgICAgICAgdGNvdW50ICs9IGl0ZW0KICAgICAgICAgICAgICAgIHByaW50KCJUb3Rh\nbCBNQUMgQWRkcmVzcyhlcykgZm91bmQ6ICVkIiAlIHRjb3VudCkKCmRlZiB3cml0ZV9yZXBvcnQo\nIGRldiwgZW50SXBMaXN0LCB0Y291bnQgPSBbXSApOgogICAgcHJpbnQoIlJ1bm5pbmcgU3dpdGNo\nIFJlcG9ydCBvbiAlcyIgJSAoIGRldiApKQogICAgc2Nhbm5lZF9uZWlnaGJvciA9IEZhbHNlCiAg\nICBpcExpc3QgPSBbXQogICAgc25tcGVycm9yLCBzd2l0Y2h0eXBlID0gZ2V0KCBkZXYsIGNvbW11\nbml0eSwgb1RhYmxlWyJzeXNEZXNjciJdLCAwICkKICAgIHN3aXRjaHR5cGUgPSBzdHIoc3dpdGNo\ndHlwZSkKICAgIGlmIHNubXBlcnJvcjoKICAgICAgICBwcmludChzbm1wZXJyb3IsICJFaXRoZXIg\nV3JvbmcgQ29tbXVuaXR5IFN0cmluZyBvciBGaXJld2FsbCBvciBTTk1QIE5vdCBSdW5uaW5nIikK\nICAgICAgICBzeXMuZXhpdCgxKQogICAgc3dpdGNoID0gZm9sbG93U3dpdGNoKCBkZXYsIGNvbW11\nbml0eSApCiAgICBzd2l0Y2guc2V0X2R1cGxleCgpCiAgICBzd2l0Y2guc2V0X3NwZWVkKCkKICAg\nIHN3aXRjaC5zZXRfcG9ydF9uYW1lKCkKICAgIHN3aXRjaC5zZXRfcGh5c19hZGRyKCkKICAgIHN3\naXRjaC5zZXRfb3Blcl9zdGF0dXMoKQogICAgc3dpdGNoLnNldF9hZG1pbl9zdGF0dXMoKQogICAg\nc3dpdGNoLnNldF9hbGlhcygpCiAgICBjb3VudCA9IDAKICAgIGNvbm5fb3V0cHV0ID0gb3Blbigi\nY29ubm5lY3RlZF9wb3J0c19vbl8iK2RldisiLmNzdiIsICJhIikKICAgIGlmICggcmUuc2VhcmNo\nKCJDaXNjb3xQUk9DVVJWRXxIUCIsIHN3aXRjaHR5cGUsIHJlLklHTk9SRUNBU0UgKSApOgogICAg\nICAgIGxjb21tLCBsdmxhbiA9IHN3aXRjaC5yZXRyaWV2ZV9jb21tdW5pdGllcyggKQogICAgICAg\nIGlmIHZlcmJvc2U6ICBwcmludChjdGltZSgpLCAiUmV0cmVpdmluZyBDb21tdW5pdHkgU3RyaW5n\nc1xuICVzIiAlICggbGNvbW0gKSkKICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4obGNvbW0pKToK\nICAgICAgICAgICAgbWFjb3V0ID0gc3dpdGNoLnN3aXRjaF9yZXBvcnQoIGxjb21tW2ldLCBsdmxh\nbltpXSwgY29ubl9vdXRwdXQgKQogICAgICAgICAgICBjb3VudCArPSBtYWNvdXQKICAgICAgICAg\nICAgdGNvdW50LmFwcGVuZChtYWNvdXQpCiAgICAgICAgcHJpbnQoInRvdGFsIE1BQyBBZGRyZXNz\nZXMgZm91bmQgb24gJXM6ICVkXG4iICUgKCBkZXYsIGNvdW50ICkpCiAgICBlbGlmICggcmUuc2Vh\ncmNoKCJOb3J0ZWx8RVJTfEZvdW5kcnkiLCBzd2l0Y2h0eXBlLCByZS5JR05PUkVDQVNFICkgKToK\nICAgICAgICBtYWNvdXQgPSBzd2l0Y2guc3dpdGNoX3JlcG9ydCggY29tbXVuaXR5LCBOb25lLCBj\nb25uX291dHB1dCApCiAgICAgICAgY291bnQgKz0gbWFjb3V0CiAgICAgICAgdGNvdW50LmFwcGVu\nZChtYWNvdXQpCiAgICAgICAgcHJpbnQoInRvdGFsIE1BQyBBZGRyZXNzZXMgZm91bmQgb24gJXM6\nICVkXG4iICUgKCBkZXYsIGNvdW50ICkpCiAgICBjb25uX291dHB1dC5jbG9zZSgpCiAgICBpZiBm\nb2xsb3c6CiAgICAgICAgbmVpZ2hib3JzID0gc3dpdGNoLmdldF9jZHBfbmVpZ2hib3JfaXBfdGFi\nbGUoKQogICAgICAgIGlmIGxlbihuZWlnaGJvcnMpID4gMDoKICAgICAgICAgICAgZm9yIG5laWdo\nYm9yIGluIG5laWdoYm9yczoKICAgICAgICAgICAgICAgIGlmIHZlcmJvc2U6ICJQcmludCBuZWln\naGJvciAlcyAiICUgbmVpZ2hib3IKICAgICAgICAgICAgICAgIGZvciBrZXksIHZhbHVlIGluIGxp\nc3QoZW50SXBMaXN0Lml0ZW1zKCkpOgogICAgICAgICAgICAgICAgICAgIGZvciBsaW5lIGluIHZh\nbHVlOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBsaW5lID09IG5laWdoYm9yOgogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgc2Nhbm5lZF9uZWlnaGJvciA9IFRydWUKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIHZlcmJvc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgcHJpbnQoInRoaXMgbmVpZ2hib3IgaGFzIGFscmVhZHkgYmVlbiBzY2FubmVkIikKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChsaW5lLCBuZWlnaGJvcikKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgaWYgc2Nhbm5lZF9u\nZWlnaGJvcjoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGlm\nIHNjYW5uZWRfbmVpZ2hib3I6CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAg\nICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZW50YWRkciA9IHdhbGsoIG5laWdoYm9y\nLCBjb21tdW5pdHksIG9UYWJsZVsiaXBBZEVudEFkZHIiXSApCiAgICAgICAgICAgICAgICAgICAg\naWYgZW50YWRkciA9PSAicmVxdWVzdFRpbWVkT3V0IjoKICAgICAgICAgICAgICAgICAgICAgICAg\nY29udGludWUKICAgICAgICAgICAgICAgICAgICBmb3IgbGluZSBpbiBlbnRhZGRyOgogICAgICAg\nICAgICAgICAgICAgICAgICBpcExpc3QuYXBwZW5kKHN3aXRjaC5jb252ZXJ0T2N0ZWN0SXAoIGxp\nbmVbMF1bMV0gKSkKICAgICAgICAgICAgICAgICAgICBlbnRJcExpc3RbbmVpZ2hib3JdID0gaXBM\naXN0CiAgICAgICAgICAgICAgICAgICAgd3JpdGVfcmVwb3J0KG5laWdoYm9yLCBlbnRJcExpc3Qs\nIHRjb3VudCkKICAgIGVsc2U6CiAgICAgICAgdGNvdW50ID0gY291bnQKICAgIHJldHVybiB0Y291\nbnQKCmRlZiB2ZXJpZnlfbWFjKCBubWFjICk6CiAgICAiIiJWZXJpZmllcyB0aGUgTUFDIEFkZHJl\nc3NlcyB0aGF0IHdhcyBpbnB1dGVkIGJ5IHRoZSB1c2VyCiAgICAgICBBbmQgcmV0dXJucyB0aGUg\nbmV3bHkgY29udmVydGVkIG5tYWMgYW5kIHRoZSBWYWxpZCBjb2RlIiIiCiAgICB2YWxpZCA9ICIi\nCiAgICBpZiByZS5zZWFyY2goIihbMC05YS1mQS1GXXsyfVw6KXs1fVswLTlhLWZBLUZdezJ9Iiwg\nbWFjKToKICAgICAgICBubWFjID0gcmUuc3ViKCJcOiIsICIgIiwgbWFjKQogICAgICAgIHZhbGlk\nID0gMQogICAgZWxpZiByZS5zZWFyY2goIihbMC05YS1mQS1GXXsyfVwtKXs1fVswLTlhLWZBLUZd\nezJ9IiwgbWFjKToKICAgICAgICBubWFjID0gcmUuc3ViKCJcLSIsICIgIiwgbWFjKQogICAgICAg\nIHZhbGlkID0gMQogICAgZWxpZiByZS5zZWFyY2goIihbMC05YS1mQS1GXXs0fVwuKXsyfVswLTlh\nLWZBLUZdezR9IiwgbWFjKToKICAgICAgICBubWFjID0gcmUuc3ViKCJcc3syfSIsICIgIiwgcmUu\nc3ViKCJeXHN8XHMkIiwgIiIsIHJlLnN1YigiXCd8XCx8XFt8XF0iLCAiIiwgc3RyKHJlLnNwbGl0\nKCIoWzAtOWEtZkEtRl17Mn0pIiwgcmUuc3ViKCJcLiIsICIiLCBtYWMpICkgKSApICkgKQogICAg\nICAgIHZhbGlkID0gMQogICAgZWxpZiByZS5zZWFyY2goIihbMC05YS1mQS1GXXsyfVxzKXs1fVsw\nLTlhLWZBLUZdezJ9IiwgbWFjKToKICAgICAgICB2YWxpZCA9IDEKICAgICAgICBwYXNzCiAgICBl\nbHNlOgogICAgICAgIHZhbGlkID0gMAogICAgaWYgdmVyYm9zZTogcHJpbnQoY3RpbWUoKSwgIiBG\naW5pc2hlZCBDaGVja2luZyBmb3IgbWFjIikKICAgIHJldHVybiggbm1hYywgdmFsaWQgKQoKCmRl\nZiB3YWxrKCBkc3dpdGNoLCBjb21tVmxhbiwgb2lkICApOgogICAgIiIiVGhpcyBmdW5jdGlvbiB3\naWxsIHJldHVybiB0aGUgdGFibGUgb2YgT0lEJ3MgdGhhdCBJIGFtIHdhbGtpbmciIiIKICAgIGNt\nZEdlbiA9IGNtZGdlbi5Db21tYW5kR2VuZXJhdG9yKCkKICAgIGVycm9ySW5kaWNhdGlvbiwgZXJy\nb3JTdGF0dXMsIGVycm9ySW5kZXgsIFwKICAgICAgICBnZW5lcmljID0gKAogICAgICAgICAgICBj\nbWRHZW4ubmV4dENtZCgKICAgICAgICAgICAgICAgIGNtZGdlbi5Db21tdW5pdHlEYXRhKGNvbW1W\nbGFuKSwKICAgICAgICAgICAgICAgIGNtZGdlbi5VZHBUcmFuc3BvcnRUYXJnZXQoKGRzd2l0Y2gs\nIDE2MSkpLAogICAgICAgICAgICAgICAgb2lkLAogICAgICAgICAgICAgICAgbG9va3VwTmFtZXM9\nVHJ1ZSwgbG9va3VwVmFsdWVzPVRydWUKICAgICAgICAgICAgKQogICAgICAgICkKICAgIGlmIGVy\ncm9ySW5kaWNhdGlvbjoKICAgICAgICByZXR1cm4gZXJyb3JJbmRpY2F0aW9uCiAgICByZXR1cm4g\nZ2VuZXJpYwoKCmRlZiBnZXQoIGRldmljZSwgY29tbVZsYW4sIG9pZCwgcnZhbCwgaW5kZXhPaWQ9\nIk5vbmUiICk6CiAgICAiIiJUaGlzIGlzIGVzc2VudGlhbGx5IG15IGdlbmVyaWMgc25tcGdldCwg\nYnV0IHdpdGggb3B0aW9ucy4gU2luY2UgaWYgSSBhbSBkb2luZyBhbgogICAgICAgc25tcGdldCwg\nSSB3aWxsIHVzdWFsbHkgZWl0aGVyIHBhc3MgYSBpbmRleCBJRCBvciBhIGxpc3Qgb2YgSUQncywg\nVGhpcyBmdW5jdGlvbiBtYWtlcwogICAgICAgbXkgbGlmZSBlYXNpZXIsIGJ5IG5vdCBjcmVhdGlu\nZyBtdWx0aXBsZSBnZXRDbWQncyIiIgogICAgY21kR2VuID0gY21kZ2VuLkNvbW1hbmRHZW5lcmF0\nb3IoKQogICAgaWYgbm90IGlzaW5zdGFuY2UocnZhbCwgaW50KToKICAgICAgICBydmFsID0gMAog\nICAgb2lkTiA9IGxpc3Qob2lkKQogICAgaWYgaXNpbnN0YW5jZShpbmRleE9pZCwgaW50KToKICAg\nICAgICBvaWROLmFwcGVuZChpbmRleE9pZCkKICAgIGVsaWYgdHlwZShpbmRleE9pZCkgPT0gbGlz\ndDoKICAgICAgICBvaWROID0gb2lkTiArIGxpc3QobWFwKGludCwgaW5kZXhPaWQpKQogICAgb2lk\nTiA9IHR1cGxlKG9pZE4pCiAgICBlcnJvckluZGljYXRpb24sIGVycm9yU3RhdHVzLCBlcnJvcklu\nZGV4LCBnZW5lcmljID0gKAogICAgICAgIGNtZEdlbi5nZXRDbWQoCiAgICAgICAgICAgIGNtZGdl\nbi5Db21tdW5pdHlEYXRhKGNvbW1WbGFuKSwKICAgICAgICAgICAgY21kZ2VuLlVkcFRyYW5zcG9y\ndFRhcmdldCgoZGV2aWNlLCAxNjEpKSwKICAgICAgICAgICAgb2lkTiwKICAgICAgICAgICAgbG9v\na3VwTmFtZXM9VHJ1ZSwgbG9va3VwVmFsdWVzPVRydWUKICAgICAgICAgICAgKQogICAgICAgICkK\nICAgIGlmIGVycm9ySW5kaWNhdGlvbjoKICAgICAgICByZXR1cm4gKGVycm9ySW5kaWNhdGlvbiwg\nZ2VuZXJpYyApCiAgICBpZiBydmFsID09IDA6CiAgICAgICAgcmV0dXJuIChlcnJvckluZGljYXRp\nb24sIHN0cihnZW5lcmljWzBdWzFdKSApCiAgICBlbGlmIHJ2YWwgPT0gMToKICAgICAgICByZXR1\ncm4gKGVycm9ySW5kaWNhdGlvbiwgZ2VuZXJpY1swXVswXSApCiAgICBlbGlmIHJ2YWwgPT0gMjoK\nICAgICAgICByZXR1cm4gKGVycm9ySW5kaWNhdGlvbiwgc3RyKGdlbmVyaWNbMF1bMV0pICkKCgoK\nZGVmIGhleDJkZWMobWFjayk6CiAgICByZXR1cm4gaW50KG1hY2ssIDE2KQoKZGVmIGRlYzJoZXgo\nbWFjayk6CiAgICByZXR1cm4gcmUuc3ViKCAiXjB4IiwgIiIsIGhleChtYWNrKSApCgpkZWYgYWxp\nYXNfbmFtZSggc3dpdGNoICk6CiAgICBhbGlhc1cgPSB3YWxrKCBzd2l0Y2gsIGNvbW11bml0eSwg\nb1RhYmxlWydpZkFsaWFzJ10gKQogICAgYWxpYXNIID0ge30KICAgIGZvciBpIGluIGFsaWFzVzoK\nICAgICAgICBhbGlhc0hbaVswXVswXVstMV1dID0gc3RyKGlbMF1bMV0pCiAgICByZXR1cm4gYWxp\nYXNICgpkZWYgYWRtaW5fc2V0dGluZ3MoIHN3aXRjaCApOgogICAgYWRtaW5XID0gd2Fsayggc3dp\ndGNoICwgY29tbXVuaXR5LCBvVGFibGVbJ2lmQWRtaW5TdGF0dXMnXSApCiAgICBhZG1pbkggPSB7\nfQogICAgZm9yIGkgaW4gYWRtaW5XOgogICAgICAgIGFkbWluSFtpWzBdWzBdWy0xXV0gPSBzdHIo\nb3N0YXR1c1tpWzBdWzFdXSkKICAgIHJldHVybiBhZG1pbkgKCmRlZiBvcGVyX3NldHRpbmdzKCBz\nd2l0Y2ggKToKICAgIG9wZXJXID0gd2Fsayggc3dpdGNoLCBjb21tdW5pdHksIG9UYWJsZVsnaWZP\ncGVyU3RhdHVzJ10gKQogICAgb3BlckggPSB7fQogICAgZm9yIGkgaW4gb3Blclc6CiAgICAgICAg\nb3BlckhbaVswXVswXVstMV1dID0gc3RyKG9zdGF0dXNbaVswXVsxXV0pCiAgICByZXR1cm4gb3Bl\nckgKCmRlZiBkdXBsZXhfc2V0dGluZ3MoIHN3aXRjaCApOgogICAgZHVwbGV4VyA9IHdhbGsoIHN3\naXRjaCwgY29tbXVuaXR5LCBvVGFibGVbJ2RvdDNTdGF0c0R1cGxleFN0YXR1cyddICkKICAgIGR1\ncGxleEggPSB7fQogICAgZm9yIGkgaW4gZHVwbGV4VzoKICAgICAgICBkdXBsZXhIW2lbMF1bMF1b\nLTFdXSA9IHN0cihkdXBsZXhbaVswXVsxXV0pCiAgICByZXR1cm4gZHVwbGV4SAoKZGVmIHNwZWVk\nX3NldHRpbmdzKCBzd2l0Y2ggKToKICAgIHNwZWVkVyA9IHdhbGsoIHN3aXRjaCwgY29tbXVuaXR5\nLCBvVGFibGVbJ2lmU3BlZWQnXSApCiAgICBzcGVlZEggPSB7fQogICAgZm9yIGkgaW4gc3BlZWRX\nOgogICAgICAgIHNwZWVkSFtpWzBdWzBdWy0xXV0gPSBzdHIocG9ydF9zcGVlZChpbnQoaVswXVsx\nXSkgKSApCiAgICByZXR1cm4gc3BlZWRICgpkZWYgcG9ydF9uYW1lKCBzd2l0Y2ggKToKICAgIHBv\ncnRXID0gd2Fsayggc3dpdGNoLCBjb21tdW5pdHksIG9UYWJsZVsnaWZEZXNjciddICkKICAgIHBv\ncnRIID0ge30KICAgIGZvciBpIGluIHBvcnRXOgogICAgICAgIHBvcnRIW2lbMF1bMF1bLTFdXSA9\nIHN0cihpWzBdWzFdKQogICAgcmV0dXJuIHBvcnRICgpkZWYgcG9ydF9zcGVlZCggc3BlZWQgKToK\nICAgIHNwZWVkID0gc3BlZWQgLyAxMDAwMDAwCiAgICBzcGVlZCA9IHN0cihzcGVlZCkrIm1iIgog\nICAgcmV0dXJuIHNwZWVkCgpjbGFzcyBmb2xsb3dTd2l0Y2gob2JqZWN0KToKICAgIGRlZiBfX2lu\naXRfXyhzZWxmLCBzd2l0Y2gsIGNvbW09InB1YmxpYyIgKToKICAgICAgICBzZWxmLmNvbW11bml0\neSA9IGNvbW0KICAgICAgICBzZWxmLnN3aXRjaCA9IHN3aXRjaAogICAgICAgIHNlbGYuc2JyYW5k\nID0gTm9uZQogICAgICAgIHNlbGYuc25tcGVycm9yLCBzZWxmLnN3aXRjaHR5cGUgPSBnZXQoIHNl\nbGYuc3dpdGNoLCBzZWxmLmNvbW11bml0eSwgb1RhYmxlWyJzeXNEZXNjciJdLCAyKQogICAgICAg\nIGlmICggcmUuc2VhcmNoKCJDaXNjbyIsIHNlbGYuc3dpdGNodHlwZSwgcmUuSUdOT1JFQ0FTRSAp\nICk6CiAgICAgICAgICAgIHNlbGYuc2JyYW5kID0gIkNpc2NvIgogICAgICAgIGVsaWYgKCByZS5z\nZWFyY2goIlBST0NVUlZFIiwgc2VsZi5zd2l0Y2h0eXBlLCByZS5JR05PUkVDQVNFICkgKToKICAg\nICAgICAgICAgc2VsZi5zYnJhbmQgPSAiUFJPQ1VSVkUiCiAgICAgICAgZWxpZiAoIHJlLnNlYXJj\naCgiSFAiLCBzZWxmLnN3aXRjaHR5cGUsIHJlLklHTk9SRUNBU0UgKSApOgogICAgICAgICAgICBz\nZWxmLnNicmFuZCA9ICJIUCIKICAgICAgICBlbGlmICggcmUuc2VhcmNoKCJOb3J0ZWx8RVJTIiwg\nc2VsZi5zd2l0Y2h0eXBlLCByZS5JR05PUkVDQVNFICkgKToKICAgICAgICAgICAgc2VsZi5zYnJh\nbmQgPSAiTm9ydGVsIgogICAgICAgIGVsaWYgKCByZS5zZWFyY2goIkZvdW5kcnkiLCBzZWxmLnN3\naXRjaHR5cGUsIHJlLklHTk9SRUNBU0UgKSApOgogICAgICAgICAgICBzZWxmLnNicmFuZCA9ICJG\nb3VuZHJ5IgoKICAgIGRlZiBnZXRfc2JyYW5kKCBzZWxmICk6CiAgICAgICAgcmV0dXJuIHNlbGYu\nc2JyYW5kCgogICAgZGVmIHNldF9kdXBsZXgoIHNlbGYgKToKICAgICAgICB0cnk6CiAgICAgICAg\nICAgIHNlbGYuZHVwbGV4SCA9IGR1cGxleF9zZXR0aW5ncyggc2VsZi5zd2l0Y2ggKQogICAgICAg\nIGV4Y2VwdDoKICAgICAgICAgICAgc2VsZi5kdXBsZXhIID0gTm9uZQoKICAgIGRlZiBzZXRfc3Bl\nZWQoIHNlbGYgKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYuc3BlZWRIID0gc3BlZWRf\nc2V0dGluZ3MoIHNlbGYuc3dpdGNoICkKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHNlbGYu\nc3BlZWRIID0gTm9uZQoKICAgIGRlZiBzZXRfcG9ydF9uYW1lKCBzZWxmICk6CiAgICAgICAgc2Vs\nZi5wb3J0TmFtZUggPSBwb3J0X25hbWUoIHNlbGYuc3dpdGNoICkKCiAgICBkZWYgc2V0X29wZXJf\nc3RhdHVzKCBzZWxmICk6CiAgICAgICAgc2VsZi5vcGVySCA9ICBvcGVyX3NldHRpbmdzKCBzZWxm\nLnN3aXRjaCApCgogICAgZGVmIHNldF9hZG1pbl9zdGF0dXMoIHNlbGYgKToKICAgICAgICBzZWxm\nLmFkbWluSCA9IGFkbWluX3NldHRpbmdzKCBzZWxmLnN3aXRjaCApCgogICAgZGVmIHNldF9hbGlh\ncyggc2VsZiApOgogICAgICAgIHNlbGYuYWxpYXNIID0gYWxpYXNfbmFtZSggc2VsZi5zd2l0Y2gg\nKQoKICAgIGRlZiBzZXRfcGh5c19hZGRyKCBzZWxmICk6CiAgICAgICAgc2VsZi5QaHlzQWRkciA9\nIHdhbGsoIHNlbGYuc3dpdGNoLCBjb21tdW5pdHksIG9UYWJsZVsiYXRQaHlzQWRkcmVzcyJdICkK\nCiAgICBkZWYgc2V0X2lmSW5kZXhfZGljdCggc2VsZiApOgogICAgICAgIHNlbGYucG9ydE5hbWVI\nID0gcG9ydF9uYW1lKCBzZWxmLnN3aXRjaCApCiAgICAgICAgc2VsZi5vcGVySCA9ICBvcGVyX3Nl\ndHRpbmdzKCBzZWxmLnN3aXRjaCApCiAgICAgICAgc2VsZi5hZG1pbkggPSBhZG1pbl9zZXR0aW5n\ncyggc2VsZi5zd2l0Y2ggKQogICAgICAgIHNlbGYuYWxpYXNIID0gYWxpYXNfbmFtZSggc2VsZi5z\nd2l0Y2ggKQogICAgICAgIHNlbGYuUGh5c0FkZHIgPSB3YWxrKCBzZWxmLnN3aXRjaCwgY29tbXVu\naXR5LCBvVGFibGVbImF0UGh5c0FkZHJlc3MiXSApCiAgICAgICAgdHJ5OgogICAgICAgICAgICBz\nZWxmLmR1cGxleEggPSBkdXBsZXhfc2V0dGluZ3MoIHNlbGYuc3dpdGNoICkKICAgICAgICBleGNl\ncHQ6CiAgICAgICAgICAgIHNlbGYuZHVwbGV4SCA9IE5vbmUKICAgICAgICB0cnk6CiAgICAgICAg\nICAgIHNlbGYuc3BlZWRIID0gc3BlZWRfc2V0dGluZ3MoIHNlbGYuc3dpdGNoICkKICAgICAgICBl\neGNlcHQ6CiAgICAgICAgICAgIHNlbGYuc3BlZWRIID0gTm9uZQoKCiAgICBkZWYgZmluZE1hY0J5\nSXAoIHNlbGYsIG5pcCApOgogICAgICAgICIiIlRoaXMgRnVuY3Rpb24gd2lsbCByZXR1cm4gdGhl\nIE1BQyBBZGRyZXNzIGlmIHRoZSBJUEFkZHJlc3MgdGhhdCAgd2FzIGluIHRoZSBBUlAgdGFibGUK\nICAgICAgICAgICBpZiBub3QgaXQgd2lsbCByZXR1cm4gTm9uZSIiIgogICAgICAgIGNvdW50ID0g\nMAogICAgICAgIG5tYWMgPSBOb25lCiAgICAgICAgZm9yIGlwQWRkcmVzcyBpbiBzZWxmLlBoeXNB\nZGRyOgogICAgICAgICAgICBpcDEgPSBzdHIoaXBBZGRyZXNzWzBdWzBdWy00Ol0pCiAgICAgICAg\nICAgIGlwbWFwID0gcmUuc3ViKCJcJ3xcW3xcXXxcKHxcKSIsICIiLCByZS5zdWIoIixccyIsICIu\nIiwgaXAxKSkKICAgICAgICAgICAgaWYgKCBuaXAgPT0gaXBtYXAgKToKICAgICAgICAgICAgICAg\nIGNvdW50ICs9IDEKICAgICAgICAgICAgICAgIG5tYWMgPSBzZWxmLmNvbnZlcnRPY3RlY3RNYWMo\nIHRvX3N0cihpcEFkZHJlc3NbMF1bMV0pICkKICAgICAgICAgICAgICAgIHByaW50KG5tYWMsIHR5\ncGUobm1hYykpCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgIGlmIGNvdW50ID09IDE6CiAg\nICAgICAgICAgIHJldHVybiggbm1hYyApCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbm1hYyA9\nIE5vbmUKICAgICAgICAgICAgcmV0dXJuKCBubWFjICkKCiAgICBkZWYgZmluZElwQnlNYWMoIHNl\nbGYsIG5tYWMgICk6CiAgICAgICAgIiIiVGhpcyBGdW5jdGlvbiB3aWxsIG9ubHkgcmV0dXJuIHRo\nZSBJUCBBZGRyZXNzIG9mIHRoZSBNQUMgeW91IGFyZSBzZWFyY2hpbmcgZm9yIGlmCiAgICAgICAg\nICAgdGhlIElQIEFkZHJlc3MgaXMgaW4gdGhlIEFSUCB0YWJsZS4gICIiIgogICAgICAgIHNlbGYu\naXBBZGRyID0gTm9uZQogICAgICAgIGZvciBtYWNrIGluIHNlbGYuUGh5c0FkZHI6CiAgICAgICAg\nICAgIGNtYWMgPSBzZWxmLmNvbnZlcnRPY3RlY3RNYWMoIHRvX3N0cihtYWNrWzBdWzFdKSApCiAg\nICAgICAgICAgIGlmIHJlLnNlYXJjaChubWFjLCBjbWFjLCByZS5JR05PUkVDQVNFKToKICAgICAg\nICAgICAgICAgIGlwMSA9IHN0cihtYWNrWzBdWzBdWy00Ol0pCiAgICAgICAgICAgICAgICBzZWxm\nLmlwQWRkciA9IHJlLnN1YigiXCd8XCh8XCl8LCIsICIiLCBpcDEpLnJlcGxhY2UoIiAiLCAiLiIp\nCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgIHJldHVybiBzZWxmLmlwQWRkcgoKICAgIGRl\nZiBjb252ZXJ0T2N0ZWN0TWFjKHNlbGYsIG1hY2spOgogICAgICAgICIiIlRoaXMgRnVuY3Rpb24g\nd2lsbCBjb252ZXJ0IHRoZSBPY3RlY3RTdHJpbmcgaW50byBhIFZhbGlkIE1BQyBBZGRyZXNzIiIi\nCiAgICAgICAgbW1hcCA9IGxpc3QobWFwKGhleCwgbGlzdChtYXAob3JkLCBtYWNrKSkgKSkKICAg\nICAgICBjbWFjID0gbW1hcAogICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihtbWFwKSk6CiAgICAg\nICAgICAgIG1tYXBbaV0gPSByZS5zdWIoIjB4IiwgIiIsIG1tYXBbaV0pCiAgICAgICAgICAgIG1t\nYXBbaV0gPSBtbWFwW2ldLnpmaWxsKDIpCiAgICAgICAgY21hYyA9IHJlLnN1YigiXCd8XCx8XFt8\nXF0iLCAiIiwgc3RyKG1tYXApICkKICAgICAgICByZXR1cm4gY21hYwoKICAgIGRlZiBjb252ZXJ0\nT2N0ZWN0SXAoc2VsZiwgaGV4aXApOgogICAgICAgICIiIlRoaXMgRnVuY3Rpb24gd2lsbCBjb252\nZXJ0IHRoZSBPY3RlY3RTdHJpbmcgaW50byBhIHZhbGlkIElwIEFkZHJlc3MiIiIKICAgICAgICBp\ncCA9IGxpc3QobWFwKGhleCwgbGlzdChtYXAob3JkLCBoZXhpcCkpICkpCiAgICAgICAgaXAgPSBs\naXN0KG1hcChoZXgyZGVjLCBpcCkpCiAgICAgICAgaXAgPSByZS5zdWIoIlwsIiwgIi4iLHJlLnN1\nYigiXCd8XFt8XF18XHMiLCIiLCBzdHIoaXApKSkKICAgICAgICByZXR1cm4gaXAKCiAgICBkZWYg\nY29udmVydERlY01hYyhzZWxmLCBtYWNrKToKICAgICAgICAiIiJUaGlzIEZ1bmN0aW9uIHdpbGwg\nY29udmVydCB0aGUgRGVjaW1hbCBpbnRvIEhFWCIiIgogICAgICAgIG1tYXAgPSBsaXN0KG1hcCho\nZXgsIG1hY2spKQogICAgICAgIGNtYWMgPSBtbWFwCiAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVu\nKG1tYXApKToKICAgICAgICAgICAgbW1hcFtpXSA9IHJlLnN1YigiMHgiLCAiIiwgbW1hcFtpXSkK\nICAgICAgICAgICAgbW1hcFtpXSA9IG1tYXBbaV0uemZpbGwoMikKICAgICAgICBjbWFjID0gcmUu\nc3ViKCJcJ3xcLHxcW3xcXSIsICIiLCBzdHIobW1hcCkgKQogICAgICAgIHJldHVybiBjbWFjCgog\nICAgZGVmIGdldF9wYWdwX3BvcnRzKCBzZWxmLCBwYWdwX2lmSW5kZXggKToKICAgICAgICAiIiJn\nZXRfcGFncF9wb3J0cyB3aWxsIHJldHVybiBhIGxpc3Qgb2YgaWZJbmRleCBJRCdzLCB0aGF0IGlz\nIGFzc29jaWF0ZWQgd2l0aAogICAgICAgIHRoZSBFdGhlckNoYW5uZWwgaWZJbmRleC4gV2lsbCBy\nZXR1cm4gYSB0dXBsZSBvZiBpZkluZGV4IElEJ3MiIiIKICAgICAgICBwYWdwX2dyb3VwID0gd2Fs\nayggc2VsZi5zd2l0Y2gsIHNlbGYuY29tbXVuaXR5LCBwYWdwVGFibGVbInBhZ3BHcm91cElmSW5k\nZXgiXSApCiAgICAgICAgaWZJbmRleExpc3QgPSBbXQogICAgICAgIGZvciBsaW5lIGluIHBhZ3Bf\nZ3JvdXA6CiAgICAgICAgICAgIGlmIHBhZ3BfaWZJbmRleCA9PSBpbnQobGluZVswXVsxXSk6CiAg\nICAgICAgICAgICAgICBpZkluZGV4TGlzdC5hcHBlbmQoaW50KGxpbmVbMF1bMF1bLTFdKSkKICAg\nICAgICByZXR1cm4gdHVwbGUoaWZJbmRleExpc3QpCgoKICAgIGRlZiByZXRyaWV2ZV9jb21tdW5p\ndGllcyggc2VsZiApOgogICAgICAgICIiIiBUaGlzIGZ1bmN0aW9uIGRvZXMgZXhhY3RseSB3aGF0\nIGl0IGlzIGRlZmluZWQgYXMuIEl0IHdpbGwgcmV0dXJuIGEgbGlzdAogICAgICAgICAgICBvZiBD\nb21tdW5pdHkgU3RyaW5ncyBmcm9tIHRoZSBlbnRMb2dpY2FsQ29tbXVuaXR5IE9JRCBUYWJsZS4K\nICAgICAgICAgICAgQXMgd2VsbCBhcyBncmFiIHRoZSBhc3NvY2lhdGVkIHZsYW4gSUQuIFRoZW4g\ncmV0dXJuIGJvdGggaW4gYSB0dXBsZSIiIgogICAgICAgIGNvbW1UYWJsZSA9IHdhbGsoIHNlbGYu\nc3dpdGNoLCBzZWxmLmNvbW11bml0eSwgb1RhYmxlWyJlbnRMb2dpY2FsQ29tbXVuaXR5Il0gKQog\nICAgICAgIGlmIHZlcmJvc2U6IHByaW50KGNvbW1UYWJsZSkKICAgICAgICBsY29tbSA9IFtdCiAg\nICAgICAgbHZsYW4gPSBbXQogICAgICAgIGZvciBjb21tIGluIGNvbW1UYWJsZToKICAgICAgICAg\nICAgaWYgdmVyYm9zZTogcHJpbnQoY3RpbWUoKSwgIiBMb29waW5nIFRocm91Z2ggQ29tbVRhYmxl\nIikKICAgICAgICAgICAgdmxhbiA9IGludChjb21tWzBdWzBdWy0xXSkKICAgICAgICAgICAgY29t\nbSA9IHN0cihjb21tWzBdWzFdKQogICAgICAgICAgICBpZiBsZW4obGNvbW0pID09IDA6CiAgICAg\nICAgICAgICAgICBsY29tbS5hcHBlbmQoY29tbSkKICAgICAgICAgICAgICAgIGx2bGFuLmFwcGVu\nZCh2bGFuKQogICAgICAgICAgICBlbGlmIGxlbihsY29tbSkgPj0gMToKICAgICAgICAgICAgICAg\nIGlmIGxjb21tWzpsZW4oY29tbVstMV0pXS5fX2NvbnRhaW5zX18oY29tbSk6CiAgICAgICAgICAg\nICAgICAgICAgaWYgdmVyYm9zZTogcHJpbnQoIkR1cGxpY2F0ZSBDb21tdW5pdHkgU3RyaW5nIikK\nICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAg\nICAgICAgICAgICAgICBsY29tbS5hcHBlbmQoY29tbSkKICAgICAgICAgICAgICAgICAgICBsdmxh\nbi5hcHBlbmQodmxhbikKICAgICAgICByZXR1cm4oIGxjb21tLCBsdmxhbiApCgogICAgZGVmIGZp\nbmRfcG9ydF9tYXRjaCggc2VsZiwgcG5hbWUgKToKICAgICAgICAiIiIgQnkgcGFzc2luZyB0aGlz\nIGZ1bmN0aW9uIHRoZSBQb3J0IE5hbWUgYW5kIFRoZSBCcmFuZCBvZgogICAgICAgICAgICB0aGlz\nIFN3aXRjaCwgeW91IHdpbGwgaW4gcmV0dXJuIGdldCB0aGUgaWZJbmRleCBhbmQgdGhlIGlmTmFt\nZSIiIgogICAgICAgIGlmIHZlcmJvc2U6IHByaW50KGN0aW1lKCksICIgSW4gZ2VuZXJpY19wbmFt\nZSBGdW5jdGlvbiIpCiAgICAgICAgc2VsZi5pZkluZGV4ID0gTm9uZQogICAgICAgIHNlbGYuaWZO\nYW1lID0gTm9uZQogICAgICAgIGNvdW50ID0gMAogICAgICAgIGlmTmFtZVRhYmxlID0gd2Fsaygg\nc2VsZi5zd2l0Y2gsIGNvbW11bml0eSwgb1RhYmxlWyJpZk5hbWUiXSApCiAgICAgICAgcGZpZWxk\nID0gcmUuY29tcGlsZSgiKFswLTldezEsMn0pXFwvKFswLTldezEsMn0pIikgICMgIjEvOSIKICAg\nICAgICBnZW5fcG5hbWUgPSBbXQogICAgICAgIG5ld19wbmFtZSA9ICIiCiAgICAgICAgaWYgKCBw\nZmllbGQuc2VhcmNoKHBuYW1lKSApOgogICAgICAgICAgICBnZW5fcG5hbWUuYXBwZW5kKHBmaWVs\nZC5tYXRjaChwbmFtZSkuZ3JvdXAoMSkpCiAgICAgICAgICAgIGdlbl9wbmFtZS5hcHBlbmQocGZp\nZWxkLm1hdGNoKHBuYW1lKS5ncm91cCgyKSkKICAgICAgICAgICAgaWYgKCBzZWxmLnNicmFuZCA9\nPSAiUFJPQ1VSVkUiICk6CiAgICAgICAgICAgICAgICBuZXdfcG5hbWUgPSBocFRhYmxlW3N0cihn\nZW5fcG5hbWVbMF0pXStzdHIoZ2VuX3BuYW1lWzFdKQogICAgICAgICAgICAgICAgY291bnQgKz0g\nMQogICAgICAgICAgICAgICAgaWYgdmVyYm9zZTogcHJpbnQobmV3X3BuYW1lKQogICAgICAgICAg\nICBpZiAoIHNlbGYuc2JyYW5kID09ICJIUCIgKToKICAgICAgICAgICAgICAgIG5ld19wbmFtZSA9\nIGhwVGFibGVbc3RyKGdlbl9wbmFtZVswXSldK3N0cihnZW5fcG5hbWVbMV0pCiAgICAgICAgICAg\nICAgICBjb3VudCArPSAxCiAgICAgICAgICAgICAgICBpZiB2ZXJib3NlOiBwcmludChuZXdfcG5h\nbWUpCiAgICAgICAgICAgIGlmICggc2VsZi5zYnJhbmQgPT0gIk5vcnRlbCIgKToKICAgICAgICAg\nICAgICAgIG5ld19wbmFtZSA9ICJTbG90OiAlcyBQb3J0OiAlcyIgJSAoIHN0cihnZW5fcG5hbWVb\nMF0pLCBzdHIoZ2VuX3BuYW1lWzFdKSApCiAgICAgICAgICAgICAgICBjb3VudCArPSAxCiAgICAg\nICAgICAgICAgICBpZiB2ZXJib3NlOiBwcmludChuZXdfcG5hbWUpCiAgICAgICAgICAgIGlmIChz\nZWxmLiBzYnJhbmQgPT0gIkZvdW5kcnkiICk6CiAgICAgICAgICAgICAgICBuZXdfcG5hbWUgPSAi\nRmFzdEV0aGVybmV0JXMiICUgKCBzdHIoZ2VuX3BuYW1lWzFdKSApCiAgICAgICAgICAgICAgICBj\nb3VudCArPSAxCiAgICAgICAgICAgICAgICBpZiB2ZXJib3NlOiBwcmludChuZXdfcG5hbWUpCgog\nICAgICAgIGZvciBpZmFjZSBpbiBpZk5hbWVUYWJsZToKICAgICAgICAgICAgaWZJbmRleCA9IGlu\ndChpZmFjZVswXVswXVstMV0pCiAgICAgICAgICAgIGlmTmFtZSA9IHN0cihpZmFjZVswXVsxXSkK\nICAgICAgICAgICAgaWYgbmV3X3BuYW1lOgogICAgICAgICAgICAgICAgaWYgKCByZS5zZWFyY2go\nbmV3X3BuYW1lLCBpZk5hbWUpICk6CiAgICAgICAgICAgICAgICAgICAgY291bnQgKz0xCiAgICAg\nICAgICAgICAgICAgICAgc2VsZi5pZkluZGV4ID0gaWZJbmRleAogICAgICAgICAgICAgICAgICAg\nIHNlbGYuaWZOYW1lID0gaWZOYW1lCiAgICAgICAgICAgICAgICAgICAgaWYgdmVyYm9zZTogcHJp\nbnQoIkZvdW5kICVzIG9uICVzIGFuZCB0aGUgaWZJbmRleCBpcyAlZCIgJSAoIG5ld19wbmFtZSwg\nc2VsZi5pZk5hbWUsIHNlbGYuaWZJbmRleCApKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAg\nICAgICAgICAgIGlmICggcmUuc2VhcmNoKCJbQS1aXSsiK3BuYW1lKyJ8IitwbmFtZSwgaWZOYW1l\nKSApOgogICAgICAgICAgICAgICAgY291bnQgKz0xCiAgICAgICAgICAgICAgICBzZWxmLmlmSW5k\nZXggPSBpZkluZGV4CiAgICAgICAgICAgICAgICBzZWxmLmlmTmFtZSA9IGlmTmFtZQogICAgICAg\nICAgICAgICAgaWYgdmVyYm9zZTogcHJpbnQoIkZvdW5kICVzIG9uICVzIGFuZCB0aGUgaWZJbmRl\neCBpcyAlZCIgJSAoIHBuYW1lLCBpZk5hbWUsIGlmSW5kZXggKSkKICAgICAgICAgICAgICAgIGJy\nZWFrCgogICAgZGVmIGdldF9pZkluZGV4KHNlbGYpOgogICAgICAgIHJldHVybiggc2VsZi5pZklu\nZGV4ICkKCiAgICBkZWYgZ2V0X2lmTmFtZShzZWxmKToKICAgICAgICByZXR1cm4oIHNlbGYuaWZO\nYW1lICkKCiAgICBkZWYgZmluZF9tYWMoc2VsZiwgbm1hYywgbmlwPU5vbmUpOgogICAgICAgIHNl\nbGYubWFjID0gbm1hYwogICAgICAgIHNubXBlcnJvciwgc3dpdGNodHlwZSA9IGdldCggc2VsZi5z\nd2l0Y2gsIHNlbGYuY29tbXVuaXR5LCBvVGFibGVbInN5c0Rlc2NyIl0sIDIpCiAgICAgICAgbVRh\nYmxlID0gaWZJbmRleCA9IE5vbmUKICAgICAgICBpZiAoIHJlLnNlYXJjaCgiQ2lzY298UFJPQ1VS\nVkV8SFAiLCBzZWxmLnNicmFuZCwgcmUuSUdOT1JFQ0FTRSkgKToKICAgICAgICAgICAgbGNvbW0s\nIGx2bGFuID0gc2VsZi5yZXRyaWV2ZV9jb21tdW5pdGllcyggKQogICAgICAgICAgICBpZiB2ZXJi\nb3NlOiAgcHJpbnQoY3RpbWUoKSwgIlJldHJpZXZpbmcgQ29tbXVuaXR5IFN0cmluZ3NcbiAlcyIg\nJSAoIGxjb21tICkpCiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihsY29tbSkpOgogICAg\nICAgICAgICAgICAgbVRhYmxlLCBpZkluZGV4ID0gc2VsZi5maW5kX21hY19vcl9pcCggc2VsZi5t\nYWMsIG5pcCwgbGNvbW1baV0sIGx2bGFuW2ldICkKICAgICAgICAgICAgICAgIGlmIGxlbihtVGFi\nbGUpID49IDE6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbGlmICggcmUuc2Vh\ncmNoKCJOb3J0ZWx8RVJTfEZvdW5kcnkiLCBzZWxmLnNicmFuZCwgcmUuSUdOT1JFQ0FTRSkgKToK\nICAgICAgICAgICAgICAgIG1UYWJsZSwgaWZJbmRleCA9IHNlbGYuZmluZF9tYWNfb3JfaXAoIHNl\nbGYubWFjLCBuaXAsIHNlbGYuY29tbXVuaXR5LCBOb25lICkKICAgICAgICByZXR1cm4gbVRhYmxl\nLCBpZkluZGV4CgogICAgZGVmIGZpbmRfbWFjX29yX2lwKCBzZWxmLCBubWFjLCBuaXAsIGNvbW0s\nIHZsYW5JRCApOgogICAgICAgIGlmIHZlcmJvc2U6IHByaW50KGN0aW1lKCksICIgSW4gZ2VuZXJp\nYyAnZmluZF9tYWNfb3JfaXAnIEZ1bmN0aW9uICIpCiAgICAgICAgaWYgdmVyYm9zZTogcHJpbnQo\nbm1hYywgbmlwLCBzZWxmLnN3aXRjaCwgY29tbSkKICAgICAgICBtYWNWbGFuVGFibGUgPSB3YWxr\nKCBzZWxmLnN3aXRjaCwgY29tbSwgb1RhYmxlWyJkb3QxZFRwRmRiUG9ydCJdICkKICAgICAgICBp\nZiB2ZXJib3NlOiBwcmludChtYWNWbGFuVGFibGUpCiAgICAgICAgbVRhYmxlID0ge30KICAgICAg\nICBjb3VudCA9IDAKICAgICAgICBpZkluZGV4ID0gTm9uZQogICAgICAgIGlmICggbGVuKG1hY1Zs\nYW5UYWJsZSkgPiAwICk6CiAgICAgICAgICAgIGlmIHZlcmJvc2U6IHByaW50KGN0aW1lKCksICIg\nRmlyc3QgSWYgU3RhdGVtZW50IGluIHRoZSBmaW5kX21hY19vcl9pcCBGdW5jdGlvbiAiKQogICAg\nICAgICAgICBmb3IgbWFjVmxhbiBpbiBtYWNWbGFuVGFibGU6CiAgICAgICAgICAgICAgICBjbWFj\nID0gc2VsZi5jb252ZXJ0RGVjTWFjKGxpc3QobWFjVmxhblswXVswXVstNjpdKSkKICAgICAgICAg\nICAgICAgIGlmIHJlLnNlYXJjaChubWFjLCBjbWFjLCByZS5JR05PUkVDQVNFKToKICAgICAgICAg\nICAgICAgICAgICBpZiB2ZXJib3NlOiBwcmludCgiTUFDIEFkZHJlc3NlcyBNYXRjaCAlcyBhbmQg\nJXMiICUgKCBubWFjLCBjbWFjICkpCiAgICAgICAgICAgICAgICAgICAgY291bnQgKz0gMQogICAg\nICAgICAgICAgICAgICAgIGJJbmRleCA9IGludChtYWNWbGFuWzBdWzFdKQogICAgICAgICAgICAg\nICAgICAgIHNubXBlcnJvciwgaWZJbmRleCA9IGdldCggc2VsZi5zd2l0Y2gsIGNvbW0sIG9UYWJs\nZVsiZG90MWRCYXNlUG9ydElmSW5kZXgiXSwgMiwgYkluZGV4ICkKICAgICAgICAgICAgICAgICAg\nICBpZiBzbm1wZXJyb3I6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KHNubXBlcnJvcikK\nICAgICAgICAgICAgICAgICAgICAgICAgc3lzLmV4aXQoMSkKICAgICAgICAgICAgICAgICAgICBp\nZkluZGV4ID0gaW50KGlmSW5kZXgpCiAgICAgICAgICAgICAgICAgICAgaWZTcGVlZCA9IHNlbGYu\nc3BlZWRIW2lmSW5kZXhdCiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAg\nICAgICAgICBpZkR1cGxleCA9IHNlbGYuZHVwbGV4SFtpZkluZGV4XQogICAgICAgICAgICAgICAg\nICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgaWZEdXBsZXggPSBOb25lCiAgICAg\nICAgICAgICAgICAgICAgcG9ydCA9IHNlbGYucG9ydE5hbWVIW2lmSW5kZXhdCiAgICAgICAgICAg\nICAgICAgICAgdmxhbiA9ICIiCiAgICAgICAgICAgICAgICAgICAgaG5hbWUgPSBOb25lCiAgICAg\nICAgICAgICAgICAgICAgaWYgdmxhbklEOgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBzbm1wZXJyb3IsIHZsYW4gPSBnZXQoIHNlbGYuc3dp\ndGNoLCBjb21tLCBvVGFibGVbImVudExvZ2ljYWxEZXNjciJdLCAyLCB2bGFuSUQgKQogICAgICAg\nICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bGFu\nID0gTm9uZQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBuaXA6CiAgICAgICAgICAgICAgICAg\nICAgICAgIGlwQWRkciA9IHN0cihzZWxmLmZpbmRJcEJ5TWFjKCBubWFjICkpCiAgICAgICAgICAg\nICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgaXBBZGRyID0gbmlwCiAgICAg\nICAgICAgICAgICAgICAgaWYgcmUuc2VhcmNoKCIoXGR7MSwzfVwuKXszfVxkezEsM30iLCBzdHIo\naXBBZGRyKSApOgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBobmFtZSA9IGdldGhvc3RieWFkZHIoaXBBZGRyKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgaG5hbWUgPSBobmFtZVswXQogICAgICAgICAgICAgICAgICAgICAgICBleGNl\ncHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBobmFtZSA9ICJQb2ludGVyIFJlY29yZCBO\nb3Qgc2V0IGZvciAlcyIgJSAoIGlwQWRkciApCiAgICAgICAgICAgICAgICAgICAgICAgIHNubXBl\ncnJvciwgc3lzTmFtZSA9IGdldCggaXBBZGRyLCBjb21tdW5pdHksIG9UYWJsZVsic3lzTmFtZSJd\nLCAyICkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgc25tcGVycm9yOiBzeXNOYW1lID0gc25t\ncGVycm9yCiAgICAgICAgICAgICAgICAgICAgICAgIHNubXBlcnJvciwgc3lzRGVzY3IgPSBnZXQo\nIGlwQWRkciwgY29tbXVuaXR5LCBvVGFibGVbInN5c0Rlc2NyIl0sIDIgKQogICAgICAgICAgICAg\nICAgICAgICAgICBpZiBzbm1wZXJyb3I6IHN5c0Rlc2NyID0gc25tcGVycm9yCiAgICAgICAgICAg\nICAgICAgICAgICAgIG1UYWJsZVtubWFjXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICJpZkRlc2NyIiA6IHBvcnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAiaWZTcGVlZCIgOiBpZlNwZWVkLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgImlmRHVwbGV4IiA6IGlmRHVwbGV4LAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgInZsYW4iIDogdmxhbiwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICJzeXNOYW1lIiA6IHN5c05hbWUsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAic3lzRGVzY3IiIDogc3lzRGVzY3IsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibm1hYyIgOiBubWFjLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImlwQWRkciIgOiBpcEFkZHIsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaG9zdE5hbWUiIDogaG5hbWUKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAg\nICBjb3VudCArPSAxCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAg\nICAgICAgc3lzTmFtZSA9ICJOb25lIgogICAgICAgICAgICAgICAgICAgICAgICBzeXNEZXNjciA9\nICJOb25lIgogICAgICAgICAgICAgICAgICAgICAgICBtVGFibGVbbm1hY10gPSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaWZEZXNjciIgOiBwb3J0LAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImlmU3BlZWQiIDogaWZTcGVlZCwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpZkR1cGxleCIgOiBpZkR1cGxl\neCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2bGFuIiA6IHZsYW4s\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic3lzTmFtZSIgOiAiTm8g\nU05NUCBBY2Nlc3MiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInN5\nc0Rlc2NyIiA6ICJObyBTTk1QIEFjY2VzcyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAibm1hYyIgOiBubWFjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgImlwQWRkciIgOiBpcEFkZHIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAiaG9zdE5hbWUiIDogaG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNvdW50ICs9IDEKICAgICAgICAgICAg\nICAgICAgICBpZiB2ZXJib3NlOiBwcmludChjdGltZSgpLCAiIERvbmUgIikKICAgICAgICAgICAg\nICAgICAgICBicmVhawoKICAgICAgICByZXR1cm4gbVRhYmxlLCBpZkluZGV4CgoKICAgIGRlZiBy\nZXR1cm5fbWFjX2J5X2lmSW5kZXgoIHNlbGYsIGNvbW0sIHZsYW5JRCApOgogICAgICAgICIiIiBU\naGlzIGZ1bmN0aW9uIHdpbGwgcmV0dXJuIGEgbGlzdCBvZiBkaWN0aW9uYWlyaWVzIGJ5IHRoZSBw\nb3J0IEluZGV4CiAgICAgICAgICAgIFNvIGxldHMgc2F5IHlvdSBwYXNzIHRoaXMgZnVuY3Rpb24g\naWZJbmRleCAxMCwgcmV0dXJuX21hY19ieV9pZkluZGV4CiAgICAgICAgICAgIHdpbGwgcmV0dXJu\nIGFueSBNQUMgQWRkcmVzc2VzIEFzc29jaWF0ZWQgd2l0aCB0aGF0IGlmSW5kZXguIiIiCgogICAg\nICAgIG1UYWJsZSA9IHt9CiAgICAgICAgc1RhYmxlID0ge30KICAgICAgICBzd2l0Y2ggPSBbXQog\nICAgICAgIG1jb3VudCA9IDAKICAgICAgICB2SWZJbmRleFRhYmxlID0gd2Fsayggc2VsZi5zd2l0\nY2gsIGNvbW0sIG9UYWJsZVsiZG90MWRCYXNlUG9ydElmSW5kZXgiXSApCiAgICAgICAgaWYgKCBs\nZW4odklmSW5kZXhUYWJsZSkgPiAwICk6CiAgICAgICAgICAgIGZvciB2IGluIHZJZkluZGV4VGFi\nbGU6CiAgICAgICAgICAgICAgICB2SW5kZXggPSBpbnQodlswXVsxXSkKICAgICAgICAgICAgICAg\nIGJJbmRleCA9IGludCh2WzBdWzBdWy0xXSkKICAgICAgICAgICAgICAgIGlmIHZlcmJvc2U6IHBy\naW50KCJOb3cgVHJ5aW5nIHRvIE1hdGNoIHRoZSAlZCBpZkluZGV4IHRvIHRoZSBicmlkZ2UgJWQg\naWZJbmRleCB0YWJsZSIgJSAoIHNlbGYuaWZJbmRleCwgdkluZGV4ICkpCiAgICAgICAgICAgICAg\nICBpZiAoIHNlbGYuaWZJbmRleCA9PSB2SW5kZXggKToKICAgICAgICAgICAgICAgICAgICBpZiB2\nZXJib3NlOiBwcmludCgiTWF0Y2ggJWQgaWZJbmRleCB0byAlZCBCcmlkZ2VpZkluZGV4IFRhYmxl\nIiAlICggc2VsZi5pZkluZGV4LCB2SW5kZXggKSkKICAgICAgICAgICAgICAgICAgICBkTSA9IHdh\nbGsoIHNlbGYuc3dpdGNoLCBjb21tLCBvVGFibGVbImRvdDFkVHBGZGJQb3J0Il0gKQogICAgICAg\nICAgICAgICAgICAgIGZvciBkIGluIGRNOgogICAgICAgICAgICAgICAgICAgICAgICBkZWNtYWMg\nPSBpbnQoZFswXVsxXSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdmVyYm9zZTogcHJpbnQo\nIk5vdyBUcnlpbmcgdG8gTWF0Y2ggdGhlICVkIGJJbmRleCB0byB0aGUgZGVjaW1hbCBicmlkZ2Ug\nJWQgSW5kZXggdGFibGUiICUgKCBiSW5kZXgsIGRlY21hYyApKQogICAgICAgICAgICAgICAgICAg\nICAgICBpZiB2bGFuSUQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbm1wZXJyb3IsIHZs\nYW4gPSBnZXQoIHNlbGYuc3dpdGNoLCBjb21tLCBvVGFibGVbImVudExvZ2ljYWxEZXNjciJdLCAy\nLCB2bGFuSUQgKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgdmxhbiA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBiSW5k\nZXggPT0gZGVjbWFjICk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtY291bnQgKz0gMQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXhMaXN0T2lkID0gbGlzdChkWzBdWzBdWy02\nOl0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBubWFjID0gIHNlbGYuY29udmVydERlY01h\nYyggaW5kZXhMaXN0T2lkICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHZlcmJvc2U6\nIHByaW50KCJGb3VuZCAlcyBEZWNpbWFsIE1hYyBhbmQgQ292ZXJ0ZWQgaW50byBhIEhFWCBNQUMg\nJXMgIiAlICggaW5kZXhMaXN0T2lkLCBubWFjICkpCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBpcEFkZHIgPSBzdHIoIHNlbGYuZmluZElwQnlNYWMoIG5tYWMgKSApCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBobmFtZSA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRy\neToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZlNwZWVkID0gc2VsZi5zcGVlZEhb\nc2VsZi5pZkluZGV4XQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGlmU3BlZWQgPSBOb25lCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWZEdXBsZXgg\nPSBzZWxmLmR1cGxleEhbc2VsZi5pZkluZGV4XQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmRHVwbGV4ID0gTm9uZQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9ydCA9IHNlbGYucG9ydE5hbWVIW3NlbGYuaWZJ\nbmRleF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlLnNlYXJjaCgiKFxkezEsM31c\nLil7M31cZHsxLDN9IiwgaXBBZGRyICk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\naWYgcmUuc2VhcmNoKCIxMjcuMC4wLlxkKyIsIGlwQWRkciApOgogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxz\nZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgaG5hbWUgPSBnZXRob3N0YnlhZGRyKGlwQWRkcikK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhuYW1lID0gaG5hbWVbMF0K\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgaG5hbWUgPSAiUG9pbnRlciBSZWNvcmQgTm90IHNl\ndCBmb3IgJXMiICUgKCBpcEFkZHIgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBzbm1wZXJyb3IsIHN5c05hbWUgPSAgZ2V0KCBpcEFkZHIsIGNvbW11bml0eSwgb1RhYmxlWyJz\neXNOYW1lIl0sIDIgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzbm1w\nZXJyb3I6IHN5c05hbWUgPSBzbm1wZXJyb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgc25tcGVycm9yLCBzeXNEZXNjciA9ICBnZXQoIGlwQWRkciwgY29tbXVuaXR5LCBvVGFi\nbGVbInN5c0Rlc2NyIl0sIDIgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBz\neXNOYW1lID0gc3RyKHN5c05hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGlmIHNubXBlcnJvcjogc3lzRGVzY3IgPSBzbm1wZXJyb3IKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgc3lzRGVzY3IgPSBzdHIoc3lzRGVzY3IpCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHNubXBlcnJvciwgc3lzTW9kZWwgPSAgZ2V0KCBpcEFkZHIsIGNv\nbW11bml0eSwgb1RhYmxlWyJlbnRQaHlzaWNhbE1vZGVsTmFtZSJdLCAyICkKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmUuc2VhcmNoKCJDaXNjb3xQUk9DVVJWRXxOb3J0\nZWx8Rm91bmRyeSIsIHN5c0Rlc2NyLCByZS5JR05PUkVDQVNFKToKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaC5hcHBlbmQoaXBBZGRyKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoLmFwcGVuZChzeXNOYW1lKQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoLmFwcGVuZChzeXNEZXNjcikK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaC5hcHBlbmQoc3lz\nTW9kZWwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2guYXBw\nZW5kKHZsYW4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2gu\nYXBwZW5kKHNlbGYuc3BlZWRIW3NlbGYuaWZJbmRleF0pCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBzd2l0Y2guYXBwZW5kKHNlbGYucG9ydE5hbWVIW3NlbGYuaWZJbmRl\neF0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtVGFibGVbbm1hY10gPSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImlmRGVzY3IiIDog\ncG9ydCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAiaWZTcGVlZCIgOiBpZlNwZWVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICJpZkR1cGxleCIgOiBpZkR1cGxleCwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmxhbiIgOiB2\nbGFuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICJzeXNOYW1lIiA6IHN5c05hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgInN5c0Rlc2NyIiA6IHN5c0Rlc2NyLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJubWFjIiA6IG5t\nYWMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgImlwQWRkciIgOiBpcEFkZHIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgImhvc3ROYW1lIiA6IGhuYW1lCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1UYWJsZVtu\nbWFjXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nImlmRGVzY3IiIDogcG9ydCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgImlmU3BlZWQiIDogaWZTcGVlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgImlmRHVwbGV4IiA6IGlmRHVwbGV4LAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmxhbiIgOiB2bGFuLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic3lzTmFtZSIgOiAiTm8g\nU05NUCBBY2Nlc3MiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAic3lzRGVzY3IiIDogIk5vIFNOTVAgQWNjZXNzIiwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5tYWMiIDogbm1hYywKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImlwQWRkciIgOiBpcEFkZHIsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJob3N0TmFtZSIgOiBo\nbmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICByZXR1cm4gbVRhYmxlCgogICAgZGVmIHN3aXRjaF9yZXBvcnQoIHNlbGYsIGNvbW0sIHZs\nYW5JRCwgY29ubl9vdXRwdXQgKToKICAgICAgICAiIiJzd2l0Y2hfcmVwb3J0IHdpbGwgd3JpdGUg\ndG8gc3Rkb3V0IGFuZCB0byBhIC5jc3YgZmlsZQogICAgICAgICAgIGV2ZXJ5dGltZSBpdCBmaW5k\ncyBhIG1hYyBhdHRhY2hlZCB0byBhIHNwZWNpZmljIEludGVyZmFjZSIiIgogICAgICAgIHZsYW4g\nPSAiIgogICAgICAgIG91dHB1dCA9IFtdCiAgICAgICAgY291bnQgPSAwCiAgICAgICAgaWYgdmxh\nbklEOgogICAgICAgICAgICBzbm1wZXJyb3IsIHZsYW4gPSBnZXQoIHNlbGYuc3dpdGNoLCBjb21t\nLCBvVGFibGVbImVudExvZ2ljYWxEZXNjciJdLCAyLCB2bGFuSUQgKQogICAgICAgIGVsc2U6CiAg\nICAgICAgICAgIHZsYW4gPSBOb25lCiAgICAgICAgYnJpZGdlVGFibGUgPSB3YWxrKCBzZWxmLnN3\naXRjaCwgY29tbSwgb1RhYmxlWydkb3QxZEJhc2VQb3J0J10gKQogICAgICAgIGRlY01hY1RhYmxl\nID0gd2Fsayggc2VsZi5zd2l0Y2gsIGNvbW0sIG9UYWJsZVsnZG90MWRUcEZkYlBvcnQnXSApCiAg\nICAgICAgaWYgdmVyYm9zZTogcHJpbnQoZGVjTWFjVGFibGUpCiAgICAgICAgaWYgKCBsZW4oZGVj\nTWFjVGFibGUpID4gMCApOgogICAgICAgICAgICBmb3IgYmluZGV4IGluIGJyaWRnZVRhYmxlOgog\nICAgICAgICAgICAgICAgYkluZGV4ID0gaW50KGJpbmRleFswXVsxXSkKICAgICAgICAgICAgICAg\nIHNubXBlcnJvciwgaWZJbmRleCA9IGdldCggc2VsZi5zd2l0Y2gsIGNvbW0sIG9UYWJsZVsnZG90\nMWRCYXNlUG9ydElmSW5kZXgnXSwgMiwgaW50KGJJbmRleCkgKQogICAgICAgICAgICAgICAgaWZJ\nbmRleCA9IGludChpZkluZGV4KQogICAgICAgICAgICAgICAgZm9yIGRtIGluIGRlY01hY1RhYmxl\nOgogICAgICAgICAgICAgICAgICAgIGlmIGRtWzBdWzFdID09IGJJbmRleDoKICAgICAgICAgICAg\nICAgICAgICAgICAgaWZEdXBsZXggPSAiIgogICAgICAgICAgICAgICAgICAgICAgICBpZlNwZWVk\nID0gc2VsZi5zcGVlZEhbaWZJbmRleF0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgaWZEdXBsZXggPSBzZWxmLmR1cGxleEhbaWZJbmRleF0K\nICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgaWZEdXBsZXggPSAiTm90IEtub3duIgogICAgICAgICAgICAgICAgICAgICAgICBwb3J0ID0g\nc2VsZi5wb3J0TmFtZUhbaWZJbmRleF0KICAgICAgICAgICAgICAgICAgICAgICAgaWZPcGVyU3Rh\ndHVzID0gc2VsZi5vcGVySFtpZkluZGV4XQogICAgICAgICAgICAgICAgICAgICAgICBpZkFkbWlu\nU3RhdHVzID0gc2VsZi5hZG1pbkhbaWZJbmRleF0KICAgICAgICAgICAgICAgICAgICAgICAgYWxp\nYXMgPSBzZWxmLmFsaWFzSFtpZkluZGV4XQogICAgICAgICAgICAgICAgICAgICAgICBkZWNNYWMg\nPSBsaXN0KGRtWzBdWzBdWy02Ol0pCiAgICAgICAgICAgICAgICAgICAgICAgIG5tYWMgPSBzZWxm\nLmNvbnZlcnREZWNNYWMoIGRlY01hYyApCiAgICAgICAgICAgICAgICAgICAgICAgIGlwQWRkciA9\nIHN0ciggc2VsZi5maW5kSXBCeU1hYyggbm1hYyApICkKICAgICAgICAgICAgICAgICAgICAgICAg\naG5hbWUgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlLnNlYXJjaCgiKFxkezEs\nM31cLil7M31cZHsxLDN9IiwgaXBBZGRyICk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBp\nZiByZS5zZWFyY2goIjEyNy4wLjAuXGQrIiwgaXBBZGRyICk6CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGhuYW1lID0gZ2V0aG9zdGJ5YWRkcihpcEFkZHIpCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGhuYW1lID0gaG5hbWVbMF0KICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhu\nYW1lID0gIlBvaW50ZXIgUmVjb3JkIE5vdCBzZXQgZm9yICVzIiAlICggaXBBZGRyICkKICAgICAg\nICAgICAgICAgICAgICAgICAgb3V0cHV0ID0gIiVzLCVzLCVzLCVzLCVzLCVzLCVzLCVzLCVzLCVz\nXG4iICUgKCBwb3J0LG5tYWMsaXBBZGRyLGhuYW1lLHZsYW4saWZBZG1pblN0YXR1cyxpZk9wZXJT\ndGF0dXMsaWZEdXBsZXgsaWZTcGVlZCxhbGlhcyApCiAgICAgICAgICAgICAgICAgICAgICAgIGNv\ndW50ICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQob3V0cHV0KQogICAgICAgICAg\nICAgICAgICAgICAgICBjb25uX291dHB1dC53cml0ZShvdXRwdXQpCiAgICAgICAgICAgICAgICAg\nICAgICAgIGNvbm5fb3V0cHV0LmZsdXNoKCkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAg\nICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgIHJldHVybiBjb3VudAoKICAgIGRl\nZiBnZXRfY2RwX25laWdoYm9yX2lwKHNlbGYsIGlmSW5kZXgpOgogICAgICAgICIiIiBUaGlzIGZ1\nbmN0aW9uIHdpbGwgZ3JhYiB0aGUgY2RwIG5laWdib3IgdGhhdCBpcyBhdHRhY2hlZAogICAgICAg\nIHRvIHRoZSBpZkluZGV4IHRoYXQgaXMgcGFzc2VkIHRvIHRoaXMgZnVuY3Rpb24KICAgICAgICAi\nIiIKICAgICAgICBzZWxmLmlmSW5kZXggPSBpZkluZGV4CiAgICAgICAgY3RhYmxlID0gd2Fsaygg\nc2VsZi5zd2l0Y2gsIHNlbGYuY29tbXVuaXR5LCBjZHBUYWJsZVsiY2RwQ2FjaGVBZGRyZXNzIl0p\nCiAgICAgICAgY291bnQgPSAwCiAgICAgICAgc2VsZi5pcCA9IE5vbmUKICAgICAgICBmb3IgaG9z\ndCBpbiBjdGFibGU6CiAgICAgICAgICAgIG1hdGNoID0gdHVwbGUoaG9zdFswXSkKICAgICAgICAg\nICAgaWYgdmVyYm9zZToKICAgICAgICAgICAgICAgIHByaW50KHNlbGYuaWZJbmRleCwgbWF0Y2hb\nMF1bLTJdLCBzZWxmLmNvbnZlcnRPY3RlY3RJcChzdHIoaG9zdFswXVsxXSkpKQogICAgICAgICAg\nICBpZiAoIHNlbGYuaWZJbmRleCA9PSBtYXRjaFswXVstMl0gKToKICAgICAgICAgICAgICAgIGlm\nIHZlcmJvc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoImZvdW5kIGlmSW5kZXggJXMgYW5k\nIGhlcmUgaXMgdGhlIGlwIGFkZHJlc3Mgb2YgdGhlIGNkcG5laWdoYm9yICVzIiBcCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICUgKHN0cihzZWxmLmlmSW5kZXgpLCBzZWxmLmNvbnZlcnRPY3Rl\nY3RJcChzdHIoaG9zdFswXVsxXSkpKSkKICAgICAgICAgICAgICAgIHNlbGYuaXAgPSBzZWxmLmNv\nbnZlcnRPY3RlY3RJcChzdHIoaG9zdFswXVsxXSkpCiAgICAgICAgcmV0dXJuIHNlbGYuaXAKCiAg\nICBkZWYgZ2V0X2NkcF9uZWlnaGJvcl9pcF90YWJsZShzZWxmKToKICAgICAgICAiIiIgVGhpcyBm\ndW5jdGlvbiB3aWxsIGdyYWIgdGhlIGNkcCBuZWlnYm9yIHRhYmxlIGFuZCByZXR1cm4gYSBsaXN0\nIG9mIG5laWdoYm9ycyIiIgogICAgICAgIGN0YWJsZSA9IHdhbGsoIHNlbGYuc3dpdGNoLCBzZWxm\nLmNvbW11bml0eSwgY2RwVGFibGVbImNkcENhY2hlQWRkcmVzcyJdKQogICAgICAgIHNlbGYuaXBU\nYWJsZSA9IFtdCiAgICAgICAgZm9yIGhvc3QgaW4gY3RhYmxlOgogICAgICAgICAgICBzZWxmLmlw\nVGFibGUuYXBwZW5kKHNlbGYuY29udmVydE9jdGVjdElwKHN0cihob3N0WzBdWzFdKSkpCiAgICAg\nICAgICAgIGlmIHZlcmJvc2U6CiAgICAgICAgICAgICAgICBwcmludChzZWxmLmNvbnZlcnRPY3Rl\nY3RJcChzdHIoaG9zdFswXVsxXSkpKQogICAgICAgIHNlbGYuaXBUYWJsZSA9IHR1cGxlKHNlbGYu\naXBUYWJsZSkKICAgICAgICByZXR1cm4gc2VsZi5pcFRhYmxlCgoKICAgIGRlZiBnZXRfbWFjX2Zy\nb21fY2RwX25laWdoYm9yKCBzZWxmLCBjc3dpdGNoLCBubWFjLCBuaXAgKToKICAgICAgICBzZWxm\nLmNzd2l0Y2ggPSBjc3dpdGNoCiAgICAgICAgc2VsZi5ubWFjID0gbm1hYwogICAgICAgIHNlbGYu\nbmlwID0gbmlwCiAgICAgICAgc25tcGVycm9yLCBzd2l0Y2h0eXBlID0gZ2V0KCBzZWxmLmNzd2l0\nY2gsIHNlbGYuY29tbXVuaXR5LCBvVGFibGVbInN5c0Rlc2NyIl0sIDIpCiAgICAgICAgaWYgc25t\ncGVycm9yOgogICAgICAgICAgICBwcmludCgiV3JvbmcgQ29tbXVuaXR5IFN0cmluZyAlcyBmb3Ig\nZGV2aWNlICVzIiAlICggc2VsZi5jb21tdW5pdHksIHNlbGYuY3N3aXRjaCApKQogICAgICAgICAg\nICBzeXMuZXhpdCgxKQogICAgICAgIGdldF9ubWFjID0gZm9sbG93U3dpdGNoKCBzZWxmLmNzd2l0\nY2gsIHNlbGYuY29tbXVuaXR5ICkKICAgICAgICBnZXRfbm1hYy5zZXRfZHVwbGV4KCkKICAgICAg\nICBnZXRfbm1hYy5zZXRfc3BlZWQoKQogICAgICAgIGdldF9ubWFjLnNldF9wb3J0X25hbWUoKQog\nICAgICAgIGlmIHNlbGYubmlwID09IE5vbmU6CiAgICAgICAgICAgIGdldF9ubWFjLnNldF9waHlz\nX2FkZHIoKQogICAgICAgIGNUYWJsZSwgc2VsZi5uZXdfaWZJbmRleCA9IGdldF9ubWFjLmZpbmRf\nbWFjKCBzZWxmLm5tYWMsIHNlbGYubmlwICkKICAgICAgICBjb3VudCA9IDAKICAgICAgICBpZiBj\nVGFibGU6CiAgICAgICAgICAgIGNvdW50ICs9IDEKICAgICAgICAgICAgcHJpbnQoIkZvdW5kICVz\nIG9uICVzXG4iICUgKCBzZWxmLm5tYWMsIHNlbGYuY3N3aXRjaCApKQogICAgICAgICAgICBmb3Ig\na2V5LCB2YWwgaW4gbGlzdChjVGFibGUuaXRlbXMoKSk6CiAgICAgICAgICAgICAgICBwcmludCgi\nU3dpdGNoIENvbm5lY3RlZCB0byAlcyIgJSAoIHNlbGYuY3N3aXRjaCApKQogICAgICAgICAgICAg\nICAgcHJpbnQoIlN3aXRjaFBvcnQgPSAlc1xuU3dpdGNoUG9ydFNwZWVkID0gJXNcblN3aXRjaFBv\ncnREdXBsZXggPSAlc1xuU3dpdGNoVmxhbiA9ICVzIiAlIFwKICAgICAgICAgICAgICAgICAgICAg\nICAoIHZhbFsiaWZEZXNjciJdLCB2YWxbImlmU3BlZWQiXSwgdmFsWyJpZkR1cGxleCJdLCB2YWxb\nInZsYW4iXSApKQogICAgICAgICAgICAgICAgcHJpbnQoIlNubXBIb3N0TmFtZSA9ICVzXG5Tbm1w\nSG9zdERlc2NyID0gJXNcbkhvc3RNQUMgID0gJXNcbkhvc3RJUCA9ICVzXG5Ib3N0TmFtZSA9ICVz\nXG4iICUgXAogICAgICAgICAgICAgICAgICAgICAgICggdmFsWyJzeXNOYW1lIl0sIHZhbFsic3lz\nRGVzY3IiXSwgdmFsWyJubWFjIl0sIHZhbFsiaXBBZGRyIl0sIHZhbFsiaG9zdE5hbWUiXSApKQog\nICAgICAgICAgICAgICAgaWYgcmUuc2VhcmNoKCJQb3J0LWNoYW5uZWwiLCB2YWxbImlmRGVzY3Ii\nXSk6CiAgICAgICAgICAgICAgICAgICAgaWYgdmVyYm9zZTogcHJpbnQoImlmSW5kZXggJWQgaXMg\nYSAlcyBpbnRlcmZhY2UiICUgKCBzZWxmLm5ld19pZkluZGV4LCB2YWxbImlmRGVzY3IiXSApKQog\nICAgICAgICAgICAgICAgICAgIGlmSW5kZXhfcGFncF9saXN0ID0gZ2V0X25tYWMuZ2V0X3BhZ3Bf\ncG9ydHMoIHNlbGYubmV3X2lmSW5kZXggKQogICAgICAgICAgICAgICAgICAgIGlmIHZlcmJvc2U6\nIHByaW50KCJMaXN0IG9mIEludGVyZmFjZXMgaXMgaW4gRXRoZXJDaGFubmVsOiAiLCBpZkluZGV4\nX3BhZ3BfbGlzdCkKICAgICAgICAgICAgICAgICAgICBzZWxmLm5ld19pZkluZGV4ID0gaWZJbmRl\neF9wYWdwX2xpc3RbMF0KICAgICAgICByZXR1cm4gKHNlbGYubmV3X2lmSW5kZXgsIGNvdW50KQoK\nIyBEaWN0aW9uYXJpZXMKCgpjZHBUYWJsZSA9IHsKICAgICAgICAgICAgImNkcENhY2hlQWRkcmVz\ncyIgOiAoMSwzLDYsMSw0LDEsOSw5LDIzLDEsMiwxLDEsNCkgIyBDSVNDTy1DRFAtTUlCCiAgICAg\nICAgICAgfQoKcGFncFRhYmxlID0gewogICAgICAgICAgICAicGFncEdyb3VwSWZJbmRleCIgOiAo\nMSwzLDYsMSw0LDEsOSw5LDk4LDEsMSwxLDEsOCkgIyBOb3QgaW4gdGhlIEhQIG1pYnMKICAgICAg\nICAgICAgfQpvVGFibGUgPSB7CiAgICAgICAgICAgImVudExvZ2ljYWxDb21tdW5pdHkiIDogKDEs\nMyw2LDEsMiwxLDQ3LDEsMiwxLDEsNCksICMgUmV0dXJucyBTTk1QIENvbW0gU3RyaW5nLiBIUCwg\nUFJPQ1VSVkUsIENJU0NPCiAgICAgICAgICAgImVudFBoeXNpY2FsTW9kZWxOYW1lIiA6ICgxLDMs\nNiwxLDIsMSw0NywxLDEsMSwxLDEzLDEpLCAjUmVtb3ZlIHRoZSAxLiBSZXR1cm5zIE1vZGVsIG51\nbWJlciwgSFAsIFBST0NVUlZFLCBDSVNDTwogICAgICAgICAgICJlbnRMb2dpY2FsRGVzY3IiIDog\nKDEsMyw2LDEsMiwxLDQ3LDEsMiwxLDEsMiksICMgUmV0dXJucyBWTEFOIGluZm8uIEhQLCBQUk9D\nVVJWRSwgQ0lTQ08KICAgICAgICAgICAiZG90MWRCYXNlUG9ydCIgOiAoMSwzLDYsMSwyLDEsMTcs\nMSw0LDEsMSksICMgUmV0dXJucyBsaXN0IG9mIGludGVyZmFjZXMuIEhQLCBQUk9DVVJWRSwgQ0lT\nQ08KICAgICAgICAgICAiZG90MWRUcEZkYlBvcnQiIDogKDEsMyw2LDEsMiwxLDE3LDQsMywxLDIp\nLCAjIFRoZSBsZWFybmVkIHBvcnQgdXNlZCBieSBhIE1BQy4gSFAsIFBST0NVUlZFLCBDSVNDTwog\nICAgICAgICAgICJkb3QxZEJhc2VQb3J0SWZJbmRleCIgOiAoMSwzLDYsMSwyLDEsMTcsMSw0LDEs\nMiksICMgTUlCLUlJIFBvcnQgaW50ZXJmYWNlIGluIHRoZSBicmlkZ2UuIEhQLCBQUk9DVVJWRSwg\nQ0lTQ08KICAgICAgICAgICAiZG90MWRUcEZkYkFkZHJlc3MiIDogICgxLDMsNiwxLDIsMSwxNyw0\nLDMsMSwxKSwgIyBVbmljYXN0IE1BQyBmb3Igd2hpY2ggdGhlIGJyaWRnZSBoYXMgZm9yd2FyZC4g\nSFAsIFBST0NVUlZFLCBDSVNDTwogICAgICAgICAgICJpZkRlc2NyIiA6ICgxLDMsNiwxLDIsMSwy\nLDIsMSwyKSwgIyBNYXAgaWZJbmRleCB0byBpbnRlcmZhY2UgbmFtZS4gSFAsIFBST0NVUlZFLCBD\nSVNDTwogICAgICAgICAgICJpZk5hbWUiIDogKDEsMyw2LDEsMiwxLDMxLDEsMSwxLDEpLCAjIFRl\neHR1YWwgbmFtZSBvZiB0aGUgaW50ZXJmYWNlLiBIUCwgUFJPQ1VSVkUsIENJU0NPCiAgICAgICAg\nICAgImlmU3BlZWQiIDogKDEsMyw2LDEsMiwxLDIsMiwxLDUpLCAjIEludGVyZmFjZSdzIGN1cnJl\nbnQgYmFuZHdpZHRoLiBIUCwgUFJPQ1VSVkUsIENJU0NPCiAgICAgICAgICAgImlmQWxpYXMiIDog\nKDEsMyw2LDEsMiwxLDMxLDEsMSwxLDE4KSwgIyBJbnRlcmZhY2UncyBuYW1lIG9yIGRlc2NyaXB0\naW9uLiBIUCwgUFJPQ1VSVkUsIENJU0NPCiAgICAgICAgICAgInN5c05hbWUiIDogKDEsMyw2LDEs\nMiwxLDEsNSksICMgUmVtb3ZlZCB0aGUgMCwgZGlkbid0IHdvcmsuIFN5c3RlbSBOYW1lLiBIUCwg\nUFJPQ1VSVkUsIENJU0NPCiAgICAgICAgICAgInN5c0Rlc2NyIiA6ICgxLDMsNiwxLDIsMSwxLDEs\nMCksICMgUmVtb3ZlZCB0aGUgMCwgaXQgZG9lc24ndCB3b3JrLiBCYXNpY2FsbHkgc2hvd3Mgc3lz\ndGVtIG1vZGVsIG51bWJlciBhbmQgZmlybXdhcmUuIEhQLCBQUk9DVVJWRSwgQ0lTQ08KICAgICAg\nICAgICAiZG90M1N0YXRzRHVwbGV4U3RhdHVzIiA6ICgxLDMsNiwxLDIsMSwxMCw3LDIsMSwxOSks\nICMgUmV0dXJucyB0aGUgaW50ZXJmYWNlIGR1cGxleC4gSFAsIFBST0NVUlZFLCBDSVNDTwogICAg\nICAgICAgICJpZkFkbWluU3RhdHVzIiA6ICgxLDMsNiwxLDIsMSwyLDIsMSw3KSwgIyBSZXR1cm5z\nIGludGVyZmFjZSBjb25maWd1cmVkIHN0YXR1cywgbGlrZSB1cCBvciBkb3duLiBIUCwgUFJPQ1VS\nVkUsIENJU0NPCiAgICAgICAgICAgImlmT3BlclN0YXR1cyIgOiAoMSwzLDYsMSwyLDEsMiwyLDEs\nOCksICMgUmV0dXJucyBpbnRlcmZhY2Ugb3BlcmF0aW9uYWwgc3RhdHVzLiBIUCwgUFJPQ1VSVkUs\nIENJU0NPCiAgICAgICAgICAgImF0UGh5c0FkZHJlc3MiIDogKDEsMyw2LDEsMiwxLDMsMSwxLDIp\nLCAjIFBST0NVUlZFLCBDSVNDTywgYnV0IEhQIGRvZXNuJ3QgcmV0dXJuIGFueXRoaW5nCiAgICAg\nICAgICAgImlwQWRFbnRBZGRyIiA6ICgxLDMsNiwxLDIsMSw0LDIwLDEsMSksICMgTGlzdHMgYWxs\nIGFzc2lnbmVkIElQIGFkZHJlc3Nlcy4gSFAsIFBST0NVUlZFLCBDSVNDTwogICAgICAgICAgICJp\ncEFkRW50SWZJbmRleCIgOiAoMSwzLDYsMSwyLDEsNCwyMCwxLDIpICNIUCwgUFJPQ1VSVkUsIENJ\nU0NPCiAgICAgICAgIH0KCmhwVGFibGUgPSB7IjEiIDogIkEiLCAiMiIgOiAiQiIsICIzIiA6ICJD\nIiwgIjQiIDogIkQiLCAiNSIgOiAiRSIsCiAgICAgICAgICAgIjYiIDogIkYiLCAiNyIgOiAiRyIs\nICI4IiA6ICJIIiwgIjkiIDogIkoiLCAiMTAiIDogIksiCiAgICAgIH0KCmR1cGxleCA9IHsKICAg\nICAgICAgIDEgOiAidW5rbm93biIsCiAgICAgICAgICAyIDogImhhbGZEdXBsZXgiLAogICAgICAg\nICAgMyA6ICJmdWxsRHVwbGV4IiwKICAgICAgICAgICcnOiAiTm90U2V0IgogICAgICAgICB9CgoK\nb3N0YXR1cyA9IHsKICAgICAgICAgICAxIDogInVwIiwKICAgICAgICAgICAyIDogImRvd24iLAog\nICAgICAgICAgIDMgOiAidGVzdGluZyIsCiAgICAgICAgICAgNCA6ICJ1bmtub3duIiwKICAgICAg\nICAgICA1IDogImRvcm1hbnQiLAogICAgICAgICAgIDYgOiAibm90UHJlc2VudCIsCiAgICAgICAg\nICAgNyA6ICJsb3dlckxheWVyRG93biIKICAgICAgICAgIH0KCnRyeToKICAgICBvcHRzLCBhcmdz\nID0gZ2V0b3B0LmdldG9wdChzeXMuYXJndlsxOl0sICJjOmQ6aTptOm46aDpyZnYiLAogICAgIFsg\nJ2NvbW11bml0eT0nLCAnZGV2aWNlPScsICJtYWM9IiwgJ2lwPScsICdwbmFtZT0nLCAncmVwb3J0\nJywgJ3ZlcmJvc2UnLCAnZm9sbG93JywgJ2hlbHAnIF0KICAgICApCmV4Y2VwdCBnZXRvcHQuZXJy\nb3I6CiAgICAgdXNhZ2UoKQoKaGVscCA9IGNvbW11bml0eSA9IGRldmljZSA9IG1hYyA9IGlwID0g\ncG5hbWUgPSB2ZXJib3NlID0gcmVwb3J0ID0gZm9sbG93ID0gTm9uZQoKZm9yIG9wdCwgdmFsIGlu\nIG9wdHM6CiAgICBpZiBvcHQgaW4gKCctYycsICctLWNvbW11bml0eScpOgogICAgICAgIGNvbW11\nbml0eSA9IHZhbAogICAgaWYgb3B0IGluICgnLWQnLCAnLS1kZXZpY2UnKToKICAgICAgICBkZXZp\nY2UgPSB2YWwKICAgIGlmIG9wdCBpbiAoJy1tJywgJy0tbWFjJyk6CiAgICAgICAgbWFjID0gdmFs\nCiAgICBpZiBvcHQgaW4gKCctaScsICctLWlwJyk6CiAgICAgICAgaXAgPSB2YWwKICAgIGlmIG9w\ndCBpbiAoJy1uJywgJy0tcG5hbWUnKToKICAgICAgICBwbmFtZSA9IHZhbAogICAgaWYgb3B0IGlu\nICgnLWgnLCAnLS1oZWxwJyk6CiAgICAgICAgaGVscCA9IHVzYWdlKCkKICAgIGlmIG9wdCBpbiAo\nJy1yJywgJy0tcmVwb3J0Jyk6CiAgICAgICAgcmVwb3J0ID0gVHJ1ZQogICAgaWYgb3B0IGluICgn\nLWYnLCAnLS1mb2xsb3cnKToKICAgICAgICBmb2xsb3cgPSBUcnVlCiAgICBpZiBvcHQgaW4gKCct\ndicsICctLXZlcmJvc2UnKToKICAgICAgICB2ZXJib3NlID0gVHJ1ZQoKCgppZiBfX25hbWVfXyA9\nPSAnX19tYWluX18nOgogICAgbWFpbigp\n'
        #decode = base64.decodebytes(filebase64)
        filepath = os.path.join(self.appPath, 'port_scan.py')
        #file = open(filepath, 'wb')
        #file.write(decode)
        cmd = ['python',
               filepath,
               '-d', d,
               '-c', c,
               '-m', m]

        process = Popen(cmd,  shell=True, stdout=PIPE, stderr=PIPE, stdin=PIPE)
        stdout, stderr = process.communicate()
        self.text_output.AppendText(stdout)
        self.text_output.AppendText(stderr)

    def init_settings(self):
        self.settings = YamlConfig(self.configfile)
        if not self.settings.value('gw'):
            self.settings.setValue('gw', '192.168.1.1')
        if not self.settings.value('community'):
            self.settings.setValue('community', 'public')
        if not self.settings.value('mac'):
            self.settings.setValue('mac', '00 00 00 00 00 00')


class MainApp(wx.App):
    def OnInit(self):
        appname = "catalystmacfinder"
        ver = "0.1"
        title = '{n} (v.{v})'.format(n=appname, v=ver)

        # get path of program dir.
        # sys._MEIPASS - variable of pyinstaller (one-dir package) with path to executable
        try:
            sys._MEIPASS
            appPath = sys._MEIPASS
        except:
            appPath = os.path.dirname(os.path.abspath(__file__))
        # set "data" in program dir as working directory
        appDataPath = appdirs.user_config_dir(appname, False)
        configfile =  os.path.join(appDataPath, 'settings.yaml')

        self.frame = MainWindow(None, title, configfile, appPath)
        return(True)

if __name__ == "__main__":
    app = MainApp(0)
    app.MainLoop()